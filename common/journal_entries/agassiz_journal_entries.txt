############################
# AGASSIZ JOURNAL ENTRIES  #
############################

#by Marco Dandolo

############################

#Geological Research
je_agassiz_geological_research = {
	icon = "gfx/interface/icons/event_icons/event_geology.dds"

	scripted_button = agassiz_stop_geologist_project_button

	group = je_group_agassiz_geology

	on_yearly_pulse = {
		effect = {
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_geological_research_progress_var
				add = 1
			}
		}
		random_events = {
			#Geological Discoveries
			1000 = curie.10 #Curie 10: Uranium deposits discovered
			1000 = dubois.72 #Dubois 72: Normal Formation discovered
			1000 = dubois.73 #Dubois 73: Great Formation discovered
			1000 = lepsius.1301 #Lepsius 1301: Cave found

			#Historical Meteorites
			100 = verrier.411 #Verrier 411: Cape York meteorite
			100 = verrier.412 #Verrier 412: Bacubirito meteorite
			100 = verrier.413 #Verrier 413: Mundrabilla meteorite
			100 = verrier.414 #Verrier 414: Willamette meteorite
			100 = verrier.415 #Verrier 415: Hoba meteorite

			5 = 0
			1 = agassiz.311 #Agassiz 311: Meteorite
			1 = agassiz.312 #Agassiz 312: Geological Survey
			1 = agassiz.313 #Agassiz 313: Mineral Deposits
			1 = agassiz.314 #Agassiz 314: Inspiring Geologist
			1 = agassiz.315 #Agassiz 315: Geological Insights
		}
	}

	immediate = {
		set_variable = {
			name = agassiz_geological_research_progress_var
			value = 0
		}
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}

	on_complete = {
		trigger_event = {
			id = agassiz.301
			popup = yes
		}
		var:dubois_geologist_var = {
			set_character_busy_and_immortal = no
		}
	}

	current_value = {
		value = var:agassiz_geological_research_progress_var
	}

	goal_add_value = {
		value = 60
	}

	invalid = {
		OR = {
			custom_tooltip = {
				text = je_geologist_dies_tt
				NOT = {
					has_variable = dubois_geologist_var
				}
			}
			custom_tooltip = {
				text = agassiz_stop_geologist_improving_project_tt
				OR = {
					trigger_if = {
						limit = { is_ai = yes }
						dubois_has_geologist = yes
						dubois_has_geologist_no_tooltip_trigger = yes
					}
					has_variable = agassiz_stop_geologist_improving_project_var
				}
			}
		}
	}

	on_invalid = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		var:dubois_geologist_var = {
			set_character_busy_and_immortal = no
		}
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

######################################################################################

######FIND ORE######

#Find Coal
je_agassiz_find_coal_project = {
	icon = "gfx/interface/icons/goods_icons/coal.dds"

	scripted_button = agassiz_stop_geologist_project_button

	group = je_group_agassiz_geology

	on_monthly_pulse = {
		effect = {
			#Calculates the Progress added (see agassiz_scripted_effects for calculation)
			agassiz_geologist_improvement_progress = yes
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_geologist_improvement_progress_var
				add = var:agassiz_monthly_geologist_improvement_progress_var
			}
			if = {
				limit = { var:agassiz_geologist_improvement_progress_var > agassiz_improvement_progress_cost }
				if = {
					limit = {
						any_scope_building = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
					}
					random_scope_building = {
						limit = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
						add_modifier = {
							name = agassiz_building_production_mult_modifier
						}
					}
					change_variable = {
						name = agassiz_geologist_improvement_progress_var
						subtract = agassiz_improvement_progress_cost
					}
				}
			}
		}
	}

	immediate = {
		set_variable = agassiz_can_stop_active_improvement_project_var #This is used to check if the country has a project already
		ordered_scope_building = {
			limit = {
				level > 0
				is_building_type = building_coal_mine
				NOT = {
					has_modifier = agassiz_building_production_mult_modifier
				}
			}
			order_by = earnings
			add_modifier = {
				name = agassiz_geologist_focus_building_modifier
			}
			root = {
				set_variable = {
					name = agassiz_building_geologist_improvement_var
					value = prev
				}
			}
		}
		#Sets the Geologist Improvement Progress at the beginning
		set_variable = {
			name = agassiz_geologist_improvement_progress_var
			value = 0
		}
		agassiz_geologist_improvement_progress = yes #Determines how much Geologist Improvement Progress will be added next month
	}

	complete = {
		custom_tooltip = {
			text = agassiz_building_has_production_modifier_tt
			any_scope_building = {
				has_modifier = agassiz_geologist_focus_building_modifier
				has_modifier = agassiz_building_production_mult_modifier
			}
		}
	}

	on_complete = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
		trigger_event = {
			id = agassiz.101
			popup = yes
		}
	}

	current_value = {
		#Keeps track of the Geology Progress. If the Progress reaches the progress_cost, a modifier will be added.
		value = var:agassiz_geologist_improvement_progress_var
	}

	goal_add_value = {
		#You can change this in agassiz_script_values
		value = agassiz_improvement_progress_cost
	}

	invalid = {
		OR = {
			custom_tooltip = {
				text = je_geologist_dies_tt
				NOT = {
					has_variable = dubois_geologist_var
				}
			}
			custom_tooltip = {
				text = agassiz_stop_geologist_improving_project_tt
				OR = {
					trigger_if = {
						limit = { is_ai = yes }
						dubois_has_geologist = yes
						dubois_has_geologist_no_tooltip_trigger = yes
					}
					has_variable = agassiz_stop_geologist_improving_project_var
				}
			}
		}
	}

	on_invalid = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		remove_variable = agassiz_stop_geologist_improving_project_var
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

#Find Iron
je_agassiz_find_iron_project = {
	icon = "gfx/interface/icons/goods_icons/iron.dds"

	scripted_button = agassiz_stop_geologist_project_button

	group = je_group_agassiz_geology

	on_monthly_pulse = {
		effect = {
			#Calculates the Progress added (see agassiz_scripted_effects for calculation)
			agassiz_geologist_improvement_progress = yes
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_geologist_improvement_progress_var
				add = var:agassiz_monthly_geologist_improvement_progress_var
			}
			if = {
				limit = { var:agassiz_geologist_improvement_progress_var > agassiz_improvement_progress_cost }
				if = {
					limit = {
						any_scope_building = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
					}
					random_scope_building = {
						limit = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
						add_modifier = {
							name = agassiz_building_production_mult_modifier
						}
					}
					change_variable = {
						name = agassiz_geologist_improvement_progress_var
						subtract = agassiz_improvement_progress_cost
					}
				}
			}
		}
	}

	immediate = {
		set_variable = agassiz_can_stop_active_improvement_project_var #This is used to check if the country has a project already
		ordered_scope_building = {
			limit = {
				level > 0
				is_building_type = building_iron_mine
				NOT = {
					has_modifier = agassiz_building_production_mult_modifier
				}
			}
			order_by = earnings
			add_modifier = {
				name = agassiz_geologist_focus_building_modifier
			}
			root = {
				set_variable = {
					name = agassiz_building_geologist_improvement_var
					value = prev
				}
			}
		}
		#Sets the Geologist Improvement Progress at the beginning
		set_variable = {
			name = agassiz_geologist_improvement_progress_var
			value = 0
		}
		agassiz_geologist_improvement_progress = yes #Determines how much Geologist Improvement Progress will be added next month
	}

	complete = {
		custom_tooltip = {
			text = agassiz_building_has_production_modifier_tt
			any_scope_building = {
				has_modifier = agassiz_geologist_focus_building_modifier
				has_modifier = agassiz_building_production_mult_modifier
			}
		}
	}

	on_complete = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
		trigger_event = {
			id = agassiz.101
			popup = yes
		}
	}

	current_value = {
		#Keeps track of the Geology Progress. If the Progress reaches the progress_cost, a modifier will be added.
		value = var:agassiz_geologist_improvement_progress_var
	}

	goal_add_value = {
		#You can change this in agassiz_script_values
		value = agassiz_improvement_progress_cost
	}

	invalid = {
		OR = {
			custom_tooltip = {
				text = je_geologist_dies_tt
				NOT = {
					has_variable = dubois_geologist_var
				}
			}
			custom_tooltip = {
				text = agassiz_stop_geologist_improving_project_tt
				OR = {
					trigger_if = {
						limit = { is_ai = yes }
						dubois_has_geologist = yes
						dubois_has_geologist_no_tooltip_trigger = yes
					}
					has_variable = agassiz_stop_geologist_improving_project_var
				}
			}
		}
	}

	on_invalid = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		remove_variable = agassiz_stop_geologist_improving_project_var
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

#Find Lead
je_agassiz_find_lead_project = {
	icon = "gfx/interface/icons/goods_icons/lead.dds"

	scripted_button = agassiz_stop_geologist_project_button

	group = je_group_agassiz_geology

	on_monthly_pulse = {
		effect = {
			#Calculates the Progress added (see agassiz_scripted_effects for calculation)
			agassiz_geologist_improvement_progress = yes
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_geologist_improvement_progress_var
				add = var:agassiz_monthly_geologist_improvement_progress_var
			}
			if = {
				limit = { var:agassiz_geologist_improvement_progress_var > agassiz_improvement_progress_cost }
				if = {
					limit = {
						any_scope_building = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
					}
					random_scope_building = {
						limit = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
						add_modifier = {
							name = agassiz_building_production_mult_modifier
						}
					}
					change_variable = {
						name = agassiz_geologist_improvement_progress_var
						subtract = agassiz_improvement_progress_cost
					}
				}
			}
		}
	}

	immediate = {
		set_variable = agassiz_can_stop_active_improvement_project_var #This is used to check if the country has a project already
		ordered_scope_building = {
			limit = {
				level > 0
				is_building_type = building_lead_mine
				NOT = {
					has_modifier = agassiz_building_production_mult_modifier
				}
			}
			order_by = earnings
			add_modifier = {
				name = agassiz_geologist_focus_building_modifier
			}
			root = {
				set_variable = {
					name = agassiz_building_geologist_improvement_var
					value = prev
				}
			}
		}
		#Sets the Geologist Improvement Progress at the beginning
		set_variable = {
			name = agassiz_geologist_improvement_progress_var
			value = 0
		}
		agassiz_geologist_improvement_progress = yes #Determines how much Geologist Improvement Progress will be added next month
	}

	complete = {
		custom_tooltip = {
			text = agassiz_building_has_production_modifier_tt
			any_scope_building = {
				has_modifier = agassiz_geologist_focus_building_modifier
				has_modifier = agassiz_building_production_mult_modifier
			}
		}
	}

	on_complete = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
		trigger_event = {
			id = agassiz.101
			popup = yes
		}
	}

	current_value = {
		#Keeps track of the Geology Progress. If the Progress reaches the progress_cost, a modifier will be added.
		value = var:agassiz_geologist_improvement_progress_var
	}

	goal_add_value = {
		#Normal value for Coal and Iron: 24
		value = 18
	}

	invalid = {
		OR = {
			custom_tooltip = {
				text = je_geologist_dies_tt
				NOT = {
					has_variable = dubois_geologist_var
				}
			}
			custom_tooltip = {
				text = agassiz_stop_geologist_improving_project_tt
				OR = {
					trigger_if = {
						limit = { is_ai = yes }
						dubois_has_geologist = yes
						dubois_has_geologist_no_tooltip_trigger = yes
					}
					has_variable = agassiz_stop_geologist_improving_project_var
				}
			}
		}
	}

	on_invalid = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		remove_variable = agassiz_stop_geologist_improving_project_var
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

#Find Sulfur
je_agassiz_find_sulfur_project = {
	icon = "gfx/interface/icons/goods_icons/sulfur.dds"

	scripted_button = agassiz_stop_geologist_project_button

	group = je_group_agassiz_geology

	on_monthly_pulse = {
		effect = {
			#Calculates the Progress added (see agassiz_scripted_effects for calculation)
			agassiz_geologist_improvement_progress = yes
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_geologist_improvement_progress_var
				add = var:agassiz_monthly_geologist_improvement_progress_var
			}
			if = {
				limit = { var:agassiz_geologist_improvement_progress_var > agassiz_improvement_progress_cost }
				if = {
					limit = {
						any_scope_building = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
					}
					random_scope_building = {
						limit = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
						add_modifier = {
							name = agassiz_building_production_mult_modifier
						}
					}
					change_variable = {
						name = agassiz_geologist_improvement_progress_var
						subtract = agassiz_improvement_progress_cost
					}
				}
			}
		}
	}

	immediate = {
		set_variable = agassiz_can_stop_active_improvement_project_var #This is used to check if the country has a project already
		ordered_scope_building = {
			limit = {
				level > 0
				is_building_type = building_sulfur_mine
				NOT = {
					has_modifier = agassiz_building_production_mult_modifier
				}
			}
			order_by = earnings
			add_modifier = {
				name = agassiz_geologist_focus_building_modifier
			}
			root = {
				set_variable = {
					name = agassiz_building_geologist_improvement_var
					value = prev
				}
			}
		}
		#Sets the Geologist Improvement Progress at the beginning
		set_variable = {
			name = agassiz_geologist_improvement_progress_var
			value = 0
		}
		agassiz_geologist_improvement_progress = yes #Determines how much Geologist Improvement Progress will be added next month
	}

	complete = {
		custom_tooltip = {
			text = agassiz_building_has_production_modifier_tt
			any_scope_building = {
				has_modifier = agassiz_geologist_focus_building_modifier
				has_modifier = agassiz_building_production_mult_modifier
			}
		}
	}

	on_complete = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
		trigger_event = {
			id = agassiz.101
			popup = yes
		}
	}

	current_value = {
		#Keeps track of the Geology Progress. If the Progress reaches the progress_cost, a modifier will be added.
		value = var:agassiz_geologist_improvement_progress_var
	}

	goal_add_value = {
		#Normal value for Coal and Iron: 24
		value = 18
	}

	invalid = {
		OR = {
			custom_tooltip = {
				text = je_geologist_dies_tt
				NOT = {
					has_variable = dubois_geologist_var
				}
			}
			custom_tooltip = {
				text = agassiz_stop_geologist_improving_project_tt
				OR = {
					trigger_if = {
						limit = { is_ai = yes }
						dubois_has_geologist = yes
						dubois_has_geologist_no_tooltip_trigger = yes
					}
					has_variable = agassiz_stop_geologist_improving_project_var
				}
			}
		}
	}

	on_invalid = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		remove_variable = agassiz_stop_geologist_improving_project_var
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

#Find Gold
je_agassiz_find_gold_project = {
	icon = "gfx/interface/icons/goods_icons/gold.dds"

	scripted_button = agassiz_stop_geologist_project_button

	group = je_group_agassiz_geology

	on_monthly_pulse = {
		effect = {
			#Calculates the Progress added (see agassiz_scripted_effects for calculation)
			agassiz_geologist_improvement_progress = yes
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_geologist_improvement_progress_var
				add = var:agassiz_monthly_geologist_improvement_progress_var
			}
			if = {
				limit = { var:agassiz_geologist_improvement_progress_var > agassiz_improvement_progress_cost }
				if = {
					limit = {
						any_scope_building = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
					}
					random_scope_building = {
						limit = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
						add_modifier = {
							name = agassiz_building_production_mult_modifier
						}
					}
					change_variable = {
						name = agassiz_geologist_improvement_progress_var
						subtract = agassiz_improvement_progress_cost
					}
				}
			}
		}
	}

	immediate = {
		set_variable = agassiz_can_stop_active_improvement_project_var #This is used to check if the country has a project already
		ordered_scope_building = {
			limit = {
				level > 0
				is_building_type = building_gold_mine
				NOT = {
					has_modifier = agassiz_building_production_mult_modifier
				}
			}
			order_by = earnings
			add_modifier = {
				name = agassiz_geologist_focus_building_modifier
			}
			root = {
				set_variable = {
					name = agassiz_building_geologist_improvement_var
					value = prev
				}
			}
		}
		#Sets the Geologist Improvement Progress at the beginning
		set_variable = {
			name = agassiz_geologist_improvement_progress_var
			value = 0
		}
		agassiz_geologist_improvement_progress = yes #Determines how much Geologist Improvement Progress will be added next month
	}

	complete = {
		custom_tooltip = {
			text = agassiz_building_has_production_modifier_tt
			any_scope_building = {
				has_modifier = agassiz_geologist_focus_building_modifier
				has_modifier = agassiz_building_production_mult_modifier
			}
		}
	}

	on_complete = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
		trigger_event = {
			id = agassiz.101
			popup = yes
		}
	}

	current_value = {
		#Keeps track of the Geology Progress. If the Progress reaches the progress_cost, a modifier will be added.
		value = var:agassiz_geologist_improvement_progress_var
	}

	goal_add_value = {
		#Normal value for Coal and Iron: 24
		value = 30
	}

	invalid = {
		OR = {
			custom_tooltip = {
				text = je_geologist_dies_tt
				NOT = {
					has_variable = dubois_geologist_var
				}
			}
			custom_tooltip = {
				text = agassiz_stop_geologist_improving_project_tt
				OR = {
					trigger_if = {
						limit = { is_ai = yes }
						dubois_has_geologist = yes
						dubois_has_geologist_no_tooltip_trigger = yes
					}
					has_variable = agassiz_stop_geologist_improving_project_var
				}
			}
		}
	}

	on_invalid = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		remove_variable = agassiz_stop_geologist_improving_project_var
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

#Find Uranium
je_agassiz_find_uranium_project = {
	icon = "gfx/interface/icons/goods_icons/curie_uranium.dds"

	scripted_button = agassiz_stop_geologist_project_button

	group = je_group_agassiz_geology

	on_monthly_pulse = {
		effect = {
			#Calculates the Progress added (see agassiz_scripted_effects for calculation)
			agassiz_geologist_improvement_progress = yes
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_geologist_improvement_progress_var
				add = var:agassiz_monthly_geologist_improvement_progress_var
			}
			if = {
				limit = { var:agassiz_geologist_improvement_progress_var > agassiz_improvement_progress_cost }
				if = {
					limit = {
						any_scope_building = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
					}
					random_scope_building = {
						limit = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_mult_modifier }
						}
						add_modifier = {
							name = agassiz_building_production_mult_modifier
						}
					}
					change_variable = {
						name = agassiz_geologist_improvement_progress_var
						subtract = agassiz_improvement_progress_cost
					}
				}
			}
		}
	}

	immediate = {
		set_variable = agassiz_can_stop_active_improvement_project_var #This is used to check if the country has a project already
		ordered_scope_building = {
			limit = {
				level > 0
				is_building_type = building_curie_uranium_mine
				NOT = {
					has_modifier = agassiz_building_production_mult_modifier
				}
			}
			order_by = earnings
			add_modifier = {
				name = agassiz_geologist_focus_building_modifier
			}
			root = {
				set_variable = {
					name = agassiz_building_geologist_improvement_var
					value = prev
				}
			}
		}
		#Sets the Geologist Improvement Progress at the beginning
		set_variable = {
			name = agassiz_geologist_improvement_progress_var
			value = 0
		}
		agassiz_geologist_improvement_progress = yes #Determines how much Geologist Improvement Progress will be added next month
	}

	complete = {
		custom_tooltip = {
			text = agassiz_building_has_production_modifier_tt
			any_scope_building = {
				has_modifier = agassiz_geologist_focus_building_modifier
				has_modifier = agassiz_building_production_mult_modifier
			}
		}
	}

	on_complete = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
		trigger_event = {
			id = agassiz.101
			popup = yes
		}
	}

	current_value = {
		#Keeps track of the Geology Progress. If the Progress reaches the progress_cost, a modifier will be added.
		value = var:agassiz_geologist_improvement_progress_var
	}

	goal_add_value = {
		#Normal value for Coal and Iron: 24
		value = 30
	}

	invalid = {
		OR = {
			custom_tooltip = {
				text = je_geologist_dies_tt
				NOT = {
					has_variable = dubois_geologist_var
				}
			}
			custom_tooltip = {
				text = agassiz_stop_geologist_improving_project_tt
				OR = {
					trigger_if = {
						limit = { is_ai = yes }
						dubois_has_geologist = yes
						dubois_has_geologist_no_tooltip_trigger = yes
					}
					has_variable = agassiz_stop_geologist_improving_project_var
				}
			}
		}
	}

	on_invalid = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		remove_variable = agassiz_stop_geologist_improving_project_var
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

#Find Oil
je_agassiz_find_oil_project = {
	icon = "gfx/interface/icons/goods_icons/oil.dds"

	scripted_button = agassiz_stop_geologist_project_button

	group = je_group_agassiz_geology

	on_monthly_pulse = {
		effect = {
			#Calculates the Progress added (see agassiz_scripted_effects for calculation)
			agassiz_geologist_improvement_progress = yes
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_geologist_improvement_progress_var
				add = var:agassiz_monthly_geologist_improvement_progress_var
			}
			if = {
				limit = { var:agassiz_geologist_improvement_progress_var > agassiz_improvement_progress_cost }
				if = {
					limit = {
						any_scope_building = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_2_mult_modifier }
						}
					}
					random_scope_building = {
						limit = {
							has_modifier = agassiz_geologist_focus_building_modifier
							NOT = { has_modifier = agassiz_building_production_2_mult_modifier }
						}
						add_modifier = {
							name = agassiz_building_production_2_mult_modifier
						}
					}
					change_variable = {
						name = agassiz_geologist_improvement_progress_var
						subtract = agassiz_improvement_progress_cost
					}
				}
			}
		}
	}

	immediate = {
		set_variable = agassiz_can_stop_active_improvement_project_var #This is used to check if the country has a project already
		ordered_scope_building = {
			limit = {
				level > 0
				is_building_type = building_oil_rig
				NOT = {
					has_modifier = agassiz_building_production_2_mult_modifier
				}
			}
			order_by = earnings
			add_modifier = {
				name = agassiz_geologist_focus_building_modifier
			}
			root = {
				set_variable = {
					name = agassiz_building_geologist_improvement_var
					value = prev
				}
			}
		}
		#Sets the Geologist Improvement Progress at the beginning
		set_variable = {
			name = agassiz_geologist_improvement_progress_var
			value = 0
		}
		agassiz_geologist_improvement_progress = yes #Determines how much Geologist Improvement Progress will be added next month
	}

	complete = {
		custom_tooltip = {
			text = agassiz_building_has_production_modifier_tt
			any_scope_building = {
				has_modifier = agassiz_geologist_focus_building_modifier
				has_modifier = agassiz_building_production_2_mult_modifier
			}
		}
	}

	on_complete = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
		trigger_event = {
			id = agassiz.102
			popup = yes
		}
	}

	current_value = {
		#Keeps track of the Geology Progress. If the Progress reaches the progress_cost, a modifier will be added.
		value = var:agassiz_geologist_improvement_progress_var
	}

	goal_add_value = {
		#Normal value for Coal and Iron: 24
		value = 30
	}

	invalid = {
		OR = {
			custom_tooltip = {
				text = je_geologist_dies_tt
				NOT = {
					has_variable = dubois_geologist_var
				}
			}
			custom_tooltip = {
				text = agassiz_stop_geologist_improving_project_tt
				OR = {
					trigger_if = {
						limit = { is_ai = yes }
						dubois_has_geologist = yes
						dubois_has_geologist_no_tooltip_trigger = yes
					}
					has_variable = agassiz_stop_geologist_improving_project_var
				}
			}
		}
	}

	on_invalid = {
		remove_variable = agassiz_can_stop_active_improvement_project_var #Needs to be removed, when the JE is removed
		agassiz_remove_je_cost_modifiers_effect = yes
		
		#Those should be removed in every geology je
		remove_variable = agassiz_geologist_improvement_progress_var
		remove_variable = agassiz_monthly_geologist_improvement_progress_var
		remove_variable = geologist_experience_add_var

		every_scope_building = {
			limit = {
				has_modifier = agassiz_geologist_focus_building_modifier
			}
			remove_modifier = agassiz_geologist_focus_building_modifier
		}
		remove_variable = agassiz_stop_geologist_improving_project_var
		var:dubois_geologist_var ?= {
			set_character_busy_and_immortal = no
		}
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

######################################################################################

#Mid-Atlantic Ridge
je_agassiz_mid_atlantic_ridge = {
	icon = "gfx/interface/icons/event_icons/event_navigation.dds"

	group = je_group_agassiz_geology

	on_monthly_pulse = {
		effect = {
			#Adds the monthly progress to the variable
			change_variable = {
				name = agassiz_mid_atlantic_expedition_progress_var
				add = 1
			}
		}
	}

	immediate = {
		set_variable = {
			name = agassiz_mid_atlantic_expedition_progress_var
			value = 0
		}
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}

	on_complete = {
		trigger_event = {
			id = agassiz.201
			popup = yes
		}
		var:dubois_geologist_var = {
			set_character_busy_and_immortal = no
		}
	}

	current_value = {
		value = var:agassiz_mid_atlantic_expedition_progress_var
	}

	goal_add_value = {
		value = 12
	}

	invalid = {
		custom_tooltip = {
			text = je_geologist_dies_tt
			NOT = {
				has_variable = dubois_geologist_var
			}
		}
	}

	on_invalid = {
		remove_modifier = agassiz_mid_atlantic_ridge_cost_modifier
	}

	progressbar = yes

	weight = 30

	should_be_pinned_by_default = yes
}

######################################################################################

#Advanced Oceanography
je_agassiz_advanced_oceanography = { 
	icon = "gfx/interface/icons/event_icons/event_navigation.dds"

	group = je_group_dubois_nature

	immediate = {
	}

	complete = {
		custom_tooltip = {
			text = je_agassiz_advanced_oceanography_success
			scope:journal_entry = {
				is_goal_complete = yes
			}
		}
	}

	on_complete = {
		dubois_large_add_technology = yes
		agassiz_add_x_geological_knowledge_effect = { AMOUNT = 1 }
	}

	invalid = {
	}

	current_value = {
		value = var:rapanui_oceanographic_understanding
	}

	goal_add_value = {
		value = 50
	}

	progressbar = yes

	weight = 10

	should_be_pinned_by_default = yes
}

######################################################################################

#Volcano Expedition
je_agassiz_volcano_expedition = {
	icon = "gfx/interface/icons/event_icons/event_geology.dds"

	scripted_progress_bar = agassiz_volcano_expedition_progress_bar
	scripted_progress_bar = agassiz_volcano_danger_progress_bar

	group = je_group_agassiz_geology

	immediate = {
	}

	on_monthly_pulse = {
		events = {
			10 = agassiz.627 #Agassiz 627: The Solar Element on Earth
		}
		random_events = {
			50 = 0

			10 = agassiz.611 #Agassiz 611: Chemical Insights
			10 = agassiz.612 #Agassiz 612: Trapped
			10 = agassiz.613 #Agassiz 613: A hardened Leader
			10 = agassiz.614 #Agassiz 614: Toxic Gases
			10 = agassiz.615 #Agassiz 615: Volcanic ejecta
			10 = agassiz.616 #Agassiz 616: Lava sample
			10 = agassiz.619 #Agassiz 619: Crystalls
			10 = agassiz.620 #Agassiz 620: River of Fire
			10 = agassiz.621 #Agassiz 621: Theories on Volcanism
			10 = agassiz.622 #Agassiz 622: Earthquake
			10 = agassiz.623 #Agassiz 623: Minerals everywhere
			10 = agassiz.624 #Agassiz 624: Exotic Specimen
			10 = agassiz.625 #Agassiz 625: Unknown Fossils
			10 = agassiz.626 #Agassiz 626: Geomagnetic data
			10 = agassiz.628 #Agassiz 628: Team begs for a rest
			10 = agassiz.629 #Agassiz 629: Inferno
			10 = agassiz.630 #Agassiz 630: Hell on Earth
			10 = agassiz.631 #Agassiz 631: Quite active Volcano
			10 = agassiz.632 #Agassiz 632: Newspaper Report
			10 = agassiz.633 #Agassiz 633: A safe resting place
		}
	}

	complete = {
		custom_tooltip = {
			text = agassiz_volcano_expedition_progress_bar_at_full_tt
			je:je_agassiz_volcano_expedition = {
				"scripted_bar_progress(agassiz_volcano_expedition_progress_bar)" >= 18
			}
		}
	}

	on_complete = {
		trigger_event = {
			id = agassiz.603
			popup = yes
		}
		var:verrier_astronomer_var = {
			set_character_busy_and_immortal = no
		}
	}

	invalid = {
		custom_tooltip = {
			text = je_geologist_dies_tt
			NOT = {
				has_variable = dubois_geologist_var
			}
		}
	}

	on_invalid = {
		agassiz_remove_volcano_expedition_effect = yes
	}

	fail = {
		custom_tooltip = {
			text = agassiz_volcano_danger_progress_bar_at_full_tt
			je:je_agassiz_volcano_expedition = {
				"scripted_bar_progress(agassiz_volcano_danger_progress_bar)" >= 6
			}
		}
	}

	on_fail = {
		trigger_event = {
			id = agassiz.604
			popup = yes
		}
	}

	timeout = 730

	on_timeout = {
		trigger_event = { 
			id = agassiz.605
			popup = yes 
		}
		var:verrier_astronomer_var = {
			set_character_busy_and_immortal = no
		}
	}

	weight = 25
}