######################
# LEPSIUS ON ACTIONS #
######################

#by Marco Dandolo

######################

on_yearly_pulse_country = { 
	on_actions = {
		lepsius_on_yearly_pulse_country
	}
}

on_monthly_pulse_country = {
	on_actions = {
		lepsius_on_monthly_pulse_country
	}
}

on_acquired_technology = {
	on_actions = {
		lepsius_on_acquired_technology
	}
}

on_building_built = {
	on_actions = {
		lepsius_on_building_built
	}
}

lepsius_on_yearly_pulse_country = {
	effect = {
		trigger_event = {
			id = lepsius.50 #Yearly artifacts from excavations
		}
	}
	# Excavation Events
	random_events = {
		500 = 0

		5 = lepsius.712 #Nefertiti
		5 = lepsius.713 #Narmer
		5 = lepsius.723 #Helmet of Meskalamdug
		5 = lepsius.732 #Diskos of Phaistos
		5 = lepsius.733 #Snake Goddess
	}
}

lepsius_on_monthly_pulse_country = {
	events = {
		lepsius.2000 #Thomsen invents the Three-Age System
	}
	effect = { #Deactivates Archaeological Museums if there is more than 1
		if = {
			limit = {
				any_scope_state = {
					is_capital = yes
					has_building = building_lepsius_archaeological_museum
					NOT = {
						has_active_building = building_lepsius_archaeological_museum
					}
				}
			}
			capital = {
				activate_building = {
					building = building_lepsius_archaeological_museum
				}
			}
		}
		if = {
			limit = {
				any_scope_state = {
					has_active_building = building_lepsius_archaeological_museum
					count > 1
				}
			}
			if = {
				limit = {
					any_scope_state = {
						is_capital = yes
						has_active_building = building_lepsius_archaeological_museum
					}
				}
				every_scope_state= {
					limit = {
						is_capital = no
						has_active_building = building_lepsius_archaeological_museum
					}
					activate_building = {
						building = building_lepsius_archaeological_museum
					}
				}
			}
			else = {
				while = {
					limit = {
						any_scope_state = {
							has_active_building = building_lepsius_archaeological_museum
							count > 1
						}
					}
					random_scope_state = {
						deactivate_building = {
							building = building_lepsius_archaeological_museum
						}
					}
				}
			}
		}
		if = {
			limit = {
				any_scope_building = {
					is_building_type = building_lepsius_archaeological_museum
				}
				NOT = {
					any_scope_state = {
						has_active_building = building_lepsius_archaeological_museum
					}
				}
			}
			if = {
				limit = {
					any_scope_state = {
						is_capital = yes
						has_building = building_lepsius_archaeological_museum
					}
				}
				capital = {
					activate_building = {
						building = building_lepsius_archaeological_museum
					}
				}
			}
			else = {
				random_scope_state = {
					limit = {
						has_building = building_lepsius_archaeological_museum
					}
					activate_building = {
						building = building_lepsius_archaeological_museum
					}
				}
			}
		}
	}
}

lepsius_on_acquired_technology = {
	events = {
		lepsius.80 #Lepsius 80: A new Age of Archaeology! (if Early Archaeology is discovered)
	}
}

lepsius_on_building_built = {
	effect = {
		if = {
			limit = {
				owner = {
					NOT = {
						has_variable = lepsius_museum_inauguration_happened
					}
					lepsius_has_archaeological_museum = yes
				}
			}
			trigger_event = {
				id = lepsius.10 #Lepsius 10: Museum inauguration
				popup = yes
			}
		}
	}
}
