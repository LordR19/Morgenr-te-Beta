#######################
# GAUDI SCRPIT VALUES #
#######################

#By Lord R

############################################################################

#This Script value depends on the technological advancement of a country.
gaudi_tech_level_multiplier_5_value = {
	value = gaudi_percentage_more_advanced_countries_value
	multiply = 5
}

#This Script Value calculates the percentage of more advanced countries that are not decentralized
gaudi_percentage_more_advanced_countries_value = {
	if = {
		limit = {
			any_country = {
				techs_researched >= root.techs_researched
			}
		}
		every_country = {
			limit = {
				NOT = { is_country_type = decentralized }
				techs_researched >= root.techs_researched
			}
			add = 1
		}
	}
	else = {
		value = 0.01
	}

	divide = gaudi_num_countries_not_decentralized_value
}

#This Script Value counts the number of countries that are not decentralized
gaudi_num_countries_not_decentralized_value = {
	every_country = {
		limit = {
			NOT = { is_country_type = decentralized }
		}
		add = 1
	}
}

### Civil Engineering Projects ###

#This script value is used to determine the number of states with the roads modifier
gaudi_states_with_roads_value = {
	every_scope_state = {
		limit = { has_modifier = gaudi_modern_roads_modifier }
		add = 1
	}
}

#This script value is used to determine the number of states with the canals modifier
gaudi_states_with_canals_value = {
	every_scope_state = {
		limit = { has_modifier = gaudi_canal_systems_modifier }
		add = 1
	}
}

#This script value is used to determine the number of states with the bridge modifier
gaudi_states_with_bridges_value = {
	every_scope_state = {
		limit = { has_modifier = gaudi_new_bridge_modifier }
		add = 1
	}
}

#This script value is used to determine the number of states with the tunnel modifier
gaudi_states_with_tunnel_value = {
	every_scope_state = {
		limit = { has_modifier = gaudi_new_tunnel_modifier }
		add = 1
	}
}

#This script value is used to determine the number of states with the Modernized Railway Lines modifier
gaudi_states_with_modernized_railways_value = {
	every_scope_state = {
		limit = { has_modifier = gaudi_modernized_railway_lines_modifier }
		add = 1
	}
}

#This script value is used to determine the number of states with railways
gaudi_states_with_railways_value = {
	every_scope_state = {
		limit = {
			any_scope_building = {
				is_building_type = building_railway
				level > 0
			}
		}
		add = 1
	}
}

#This script value is used to determine the number of construction sectors with the modifiers
gaudi_num_construction_sectors_with_modifiers_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_construction_sector
			level > 0
			has_modifier = gaudi_new_construction_methods_modifier
			has_modifier = gaudi_faster_construction_methods_modifier
			has_modifier = gaudi_efficient_construction_methods_modifier
		}
		add = 1
	}
}

#This script value is used to determine the number of construction sectors
gaudi_num_construction_sectors_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_construction_sector
			level > 0	
		}
		add = 1
	}
}

#This script value is used to determine the number of states with the topographic map modifier
gaudi_states_with_topographic_map_value = {
	every_scope_state = {
		limit = { has_modifier = gaudi_topographic_state_map_modifier }
		add = 1
	}
}

#This script value is used to determine the number of railways with the first modifier
gaudi_num_railway_buildings_with_first_modifier_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_railway
			level > 0
			has_modifier = gaudi_locomotive_tier_1_modifier
		}
		add = 1
	}
}

#This script value is used to determine the number of railways with the second modifier
gaudi_num_railway_buildings_with_second_modifier_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_railway
			level > 0
			has_modifier = gaudi_locomotive_tier_1_modifier
			has_modifier = gaudi_locomotive_tier_2_modifier
		}
		add = 1
	}
}

#This script value is used to determine the number of railways with the third modifier
gaudi_num_railway_buildings_with_third_modifier_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_railway
			level > 0
			has_modifier = gaudi_locomotive_tier_1_modifier
			has_modifier = gaudi_locomotive_tier_2_modifier
			has_modifier = gaudi_locomotive_tier_3_modifier
		}
		add = 1
	}
}

#This script value is used to determine the number of railways with the fourth modifier
gaudi_num_railway_buildings_with_fourth_modifier_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_railway
			level > 0
			has_modifier = gaudi_locomotive_tier_1_modifier
			has_modifier = gaudi_locomotive_tier_2_modifier
			has_modifier = gaudi_locomotive_tier_3_modifier
			has_modifier = gaudi_locomotive_tier_4_modifier
		}
		add = 1
	}
}

#This script value is used to determine the number of railways with the modifiers
gaudi_num_railway_buildings_with_modifiers_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_railway
			level > 0
			has_modifier = gaudi_locomotive_tier_1_modifier
			has_modifier = gaudi_locomotive_tier_2_modifier
			has_modifier = gaudi_locomotive_tier_3_modifier
			has_modifier = gaudi_locomotive_tier_4_modifier
			has_modifier = gaudi_locomotive_tier_5_modifier
		}
		add = 1
	}
}

#This script value is used to determine the number of railways
gaudi_num_railway_buildings_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_railway
			level > 0	
		}
		add = 1
	}
}

#This script value is used to determine the number of airport with the modifiers
gaudi_num_airport_buildings_with_modifiers_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_airport
			level > 0
			has_modifier = gaudi_runway_expansion_mult_modifier
			has_modifier = gaudi_state_of_the_art_planes_mult_modifier
			has_modifier = gaudi_efficient_motors_modifier
		}
		add = 1
	}
}

#This script value is used to determine the number of airport
gaudi_num_airport_buildings_value = {
	every_scope_building = {
		limit = {
			is_building_type = building_airport
			level > 0	
		}
		add = 1
	}
}

#I needed to inverse the infrastructure_balance out of some reason
gaudi_infrastructure_balance = {
	value = 0
	if = {
		limit = {
			infrastructure > 0
		}
		value = infrastructure
		subtract = infrastructure_usage
		multiply = -1
	}
}

#Defines the base cost of the Research modifier
gaudi_research_progress_cost = {
	value = 36
}

#Defines the base cost of the road modifier
gaudi_road_progress_cost = {
	value = 18
}

#Defines the base cost of the canal modifier
gaudi_canal_progress_cost = {
	value = 36
}

#Defines the base cost of the bridge modifier
gaudi_bridge_progress_cost = {
	value = 9
}

#Defines the base cost of the tunnel modifier
gaudi_tunnel_progress_cost = {
	value = 26
}

#Defines the base cost of the construction sector modifiers
gaudi_construction_sectors_progress_cost = {
	value = 12
}

#Defines the base cost of the construction sector modifiers
gaudi_topographic_map_progress_cost = {
	value = 60
}

#Defines the base cost of the Locomotive modifiers
gaudi_locomotives_progress_cost = {
	value = 48
}

#Defines the base cost of the Industry modifiers
gaudi_industries_progress_cost = {
	value = 24
}

#Defines the base cost of the Advanced Weapons modifier
gaudi_advanced_weapons_progress_cost = {
	value = 180
}

#Defines the base cost of the Advanced Defence modifier
gaudi_advanced_defence_progress_cost = {
	value = 180
}

#Defines the base cost of the Advanced Tanks modifier
gaudi_advanced_tanks_progress_cost = {
	value = 160
}

#Defines the base cost of a new airport modifier
gaudi_civil_airport_cost = {
	value = 18
}

#Defines the base cost of the Advanced Aircraft modifier
gaudi_advanced_aircraft_progress_cost = {
	value = 180
}

#This script value is used to determine the amount of total tooling workshop levels
# higher pms add more points
gaudi_num_tooling_workshop_levels_value = {
	value = 0
	every_scope_building = {
		limit = {
			is_building_type = building_tooling_workshops
			has_active_production_method = pm_pig_iron
		}
		add = level
	}
	every_scope_building = {
		limit = {
			is_building_type = building_tooling_workshops
			has_active_production_method = pm_steel
		}
		add = {
			add = level
			multiply = 2
		}
	}
	every_scope_building = {
		limit = {
			is_building_type = building_tooling_workshops
			has_active_production_method = pm_rubber_grips
		}
		add = {
			add = level
			multiply = 5
		}
	}
	multiply = 0.01
}

#This value is used keep a part of the progress to the mechanical computer
gaudi_mechanical_computer_progress_percentage_value = {
	value = "je:je_gaudi_mechanical_computer_project.scripted_bar_progress(gaudi_mechanical_computer_project_progress_bar)"
	multiply = 0.7
}

#Calculates the monthly mechanical computer progress
gaudi_mechanical_computer_monthly_progress_value = {
	value = 1
	if = {
		limit = {
			gaudi_has_mechanical_engineer_trigger = yes
		}
		add =  1
		if = {
			limit = {
				var:gaudi_engineer_var = {
					has_variable = gaudi_mechanical_engineer_experience
				}
			}
			add = {
				value = var:gaudi_engineer_var.var:gaudi_mechanical_engineer_experience
				divide = 300
			}
		}
		if = {
			limit = {
				gaudi_has_mechanical_engineer_trigger = yes
				var:gaudi_engineer_var = {
					has_trait = gaudi_mechanical_engineer
				}
			}
			add = 1
		}
		if = {
			limit = {
				gaudi_has_mechanical_engineer_trigger = yes
				# Engineer is mathematician
				var:gaudi_engineer_var = {
					has_trait = verrier_mathematician
				}
			}
			add = 1
		}
		if = {
			limit = {
				gaudi_has_mechanical_engineer_trigger = yes
				var:gaudi_engineer_var = {
					has_trait = innovative
				}
			}
			add = 0.5
		}
		if = {
			limit = {
				gaudi_has_mechanical_engineer_trigger = yes
				var:gaudi_engineer_var = {
					has_trait = curie_physicist
				}
			}
			add = 0.5
		}
		if = {
			limit = {
				gaudi_has_mechanical_engineer_trigger = yes
				var:gaudi_engineer_var = {
					has_trait = meticulous
				}
			}
			add = 0.1
		}
		if = {
			limit = {
				gaudi_has_mechanical_engineer_trigger = yes
				var:gaudi_engineer_var = {
					has_trait = persistent
				}
			}
			add = 0.1
		}
		if = {
			limit = {
				has_variable = gaudi_engineer_var
				var:gaudi_engineer_var = {
					OR = {
						has_trait = alcoholic
						has_trait = expensive_tastes
						has_trait = opium_addiction
						has_trait = cocaine_addiction
						has_trait = syphilis
						has_trait = psychological_affliction
					}
				}
			}
			add = -0.2
		}
		if = {
			limit = {
				has_variable = gaudi_engineer_var
				var:gaudi_engineer_var = {
					has_trait = senile
				}
			}
			add = -3
		}
	}
	if = {
		limit = {
			academics_num_mathematical_universities > 0
		}
		add = academics_mathematical_university_multiplier_tiny
	}
	if = {
		limit = {
			gaudi_num_tooling_workshop_levels_value > 0
		}
		add = gaudi_num_tooling_workshop_levels_value
	}
}

#This value is used for calculating how much progress you gain from the experience of the mechanical engineer
gaudi_mechanical_engineer_progress_gain_from_experience = {
	value = var:gaudi_engineer_var.var:gaudi_mechanical_engineer_experience
	divide = 300
}