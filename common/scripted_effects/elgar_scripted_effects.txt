##########################
# ELGAR SCRIPTED EFFECTS #
##########################

#by Marco Dandolo

#############################

###Technology Bonus###

#Small Add
elgar_small_add_technology = {
	if = {
		limit = {
			can_research = elgar_classicism_tech
		}
		add_technology_progress = { progress = 1500 technology = elgar_classicism_tech }
	}
	else_if = {
		limit = {
			can_research = romanticism
		}
		add_technology_progress = { progress = 1500 technology = romanticism }
	}
	else_if = {
		limit = {
			can_research = realism
		}
		add_technology_progress = { progress = 1500 technology = realism }
	}
	else_if = {
		limit = {
			can_research = elgar_irrationalism_tech
		}
		add_technology_progress = { progress = 1500 technology = elgar_irrationalism_tech }
	}
	else_if = {
		limit = {
			can_research = camera
		}
		add_technology_progress = { progress = 3000 technology = camera }
	}
	else_if = {
		limit = {
			can_research = film
		}
		add_technology_progress = { progress = 3000 technology = civilizing_mission }
	}
	else_if = {
		limit = {
			can_research = elgar_art_deco_tech
		}
		add_technology_progress = { progress = 3000 technology = elgar_art_deco_tech }
	}
	else_if = {
		limit = {
			can_research = elgar_neoclassicism_tech
		}
		add_technology_progress = { progress = 3000 technology = elgar_neoclassicism_tech }
	}
	else_if = {
		limit = {
			can_research = elgar_new_objectivity_tech
		}
		add_technology_progress = { progress = 3000 technology = elgar_new_objectivity_tech }
	}
	else_if = {
		limit = {
			can_research = organized_sports
		}
		add_technology_progress = { progress = 3000 technology = organized_sports }
	}
	else_if = {
		limit = {
			can_research = elgar_mass_culture_tech
		}
		add_technology_progress = { progress = 5500 technology = elgar_mass_culture_tech }
	}
	else = {
		#TODO add an effect
	}
}

#Medium Add
elgar_medium_add_technology = {
	if = {
		limit = {
			can_research = elgar_classicism_tech
		}
		add_technology_progress = { progress = 3500 technology = elgar_classicism_tech }
	}
	else_if = {
		limit = {
			can_research = romanticism
		}
		add_technology_progress = { progress = 3500 technology = romanticism }
	}
	else_if = {
		limit = {
			can_research = realism
		}
		add_technology_progress = { progress = 3500 technology = realism }
	}
	else_if = {
		limit = {
			can_research = elgar_irrationalism_tech
		}
		add_technology_progress = { progress = 3500 technology = elgar_irrationalism_tech }
	}
	else_if = {
		limit = {
			can_research = camera
		}
		add_technology_progress = { progress = 5500 technology = camera }
	}
	else_if = {
		limit = {
			can_research = film
		}
		add_technology_progress = { progress = 5500 technology = civilizing_mission }
	}
	else_if = {
		limit = {
			can_research = elgar_art_deco_tech
		}
		add_technology_progress = { progress = 5500 technology = elgar_art_deco_tech }
	}
	else_if = {
		limit = {
			can_research = elgar_neoclassicism_tech
		}
		add_technology_progress = { progress = 5500 technology = elgar_neoclassicism_tech }
	}
	else_if = {
		limit = {
			can_research = elgar_new_objectivity_tech
		}
		add_technology_progress = { progress = 5500 technology = elgar_new_objectivity_tech }
	}
	else_if = {
		limit = {
			can_research = organized_sports
		}
		add_technology_progress = { progress = 5500 technology = organized_sports }
	}
	else_if = {
		limit = {
			can_research = elgar_mass_culture_tech
		}
		add_technology_progress = { progress = 9000 technology = elgar_mass_culture_tech }
	}
	else = {
		#TODO add an effect
	}
}

#Large Add
elgar_large_add_technology = {
	if = {
		limit = {
			can_research = elgar_classicism_tech
		}
		add_technology_progress = { progress = 6000 technology = elgar_classicism_tech }
	}
	else_if = {
		limit = {
			can_research = romanticism
		}
		add_technology_progress = { progress = 6000 technology = romanticism }
	}
	else_if = {
		limit = {
			can_research = realism
		}
		add_technology_progress = { progress = 6000 technology = realism }
	}
	else_if = {
		limit = {
			can_research = elgar_irrationalism_tech
		}
		add_technology_progress = { progress = 6000 technology = elgar_irrationalism_tech }
	}
	else_if = {
		limit = {
			can_research = camera
		}
		add_technology_progress = { progress = 9000 technology = camera }
	}
	else_if = {
		limit = {
			can_research = film
		}
		add_technology_progress = { progress = 9000 technology = civilizing_mission }
	}
	else_if = {
		limit = {
			can_research = elgar_art_deco_tech
		}
		add_technology_progress = { progress = 9000 technology = elgar_art_deco_tech }
	}
	else_if = {
		limit = {
			can_research = elgar_neoclassicism_tech
		}
		add_technology_progress = { progress = 9000 technology = elgar_neoclassicism_tech }
	}
	else_if = {
		limit = {
			can_research = elgar_new_objectivity_tech
		}
		add_technology_progress = { progress = 9000 technology = elgar_new_objectivity_tech }
	}
	else_if = {
		limit = {
			can_research = organized_sports
		}
		add_technology_progress = { progress = 9000 technology = organized_sports }
	}
	else_if = {
		limit = {
			can_research = elgar_mass_culture_tech
		}
		add_technology_progress = { progress = 15000 technology = elgar_mass_culture_tech }
	}
	else = {
		#TODO add an effect
	}
}

#############################

###Composer Lotto###

elgar_composer_lotto_1 = {

	if = {
		limit = {
			elgar_has_great_composer = yes
		}
		trigger_event = {
			id = elgar.321 #Elgar 321: Great Composer meet
			days = 7
		}
	}
	random_list = {
		3 = { 
			trigger_event = {
				id = elgar.301 #Elgar 301: Good rehearsals
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.302 #Elgar 302: Mediocre rehearsals
				days = { 14 21 }
			}
		}
		
		1 = { 
			trigger_event = {
				id = elgar.305 #Elgar 305: Sold out!
				days = { 14 21 }
			}
		}
		3 = { 
			trigger_event = {
				id = elgar.307 #Elgar 307: Musical friendship
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.308 #Elgar 308: Musical rivalry
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.309 #Elgar 309: Inspirations
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.310 #Elgar 310: Mania
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.311 #Elgar 311: Music brings people together
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.314 #Elgar 314: No inspiration
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.315 #Elgar 315: A private concert
				days = { 14 21 }
			}
		}
	}
}

elgar_composer_lotto_2 = {
	random_list = {
		2 = { 
			trigger_event = {
				id = elgar.303 #Elgar 303: An amorous dedication
				days = { 35 42 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.304 #Elgar 304: An evening reception (Monarchy)
				days = { 35 42 }
			}
		}
		1 = { 
			trigger_event = {
				id = elgar.306 #Elgar 306: Surprising premiere
				days = { 35 42 }
			}
		}
		1 = { 
			trigger_event = {
				id = elgar.312 #Elgar 312: Assassination attempt at the Opera!
				days = { 35 42 }
			}
		}
		1 = { 
			trigger_event = {
				id = elgar.313 #Elgar 313: A minor work
				days = { 35 42 }
			}
		}
	}
}

elgar_composer_lotto_3 = {
	random_list = {
		1 = { 
			trigger_event = {
				id = elgar.317 #Elgar 317: Musical desaster
				days = { 56 63 }
			}
		}
		1 = { 
			trigger_event = {
				id = elgar.318 #Elgar 318: Scandal concert
				days = { 56 63 }
			}
		}
		1 = { 
			trigger_event = {
				id = elgar.319 #Elgar 319: Zeitgeist
				days = { 56 63 }
			}
		}
		1 = { 
			trigger_event = {
				id = elgar.320 #Elgar 320: Propaganda
				days = { 56 63 }
			}
		}
	}
}

elgar_liszt_lotto = {

	if = {
		limit = {
			elgar_has_great_composer = yes
		}
		trigger_event = {
			id = elgar.321 #Elgar 321: Great Composer meet
			days = 7
		}
	}
	random_list = {
		2 = { 
			trigger_event = {
				id = elgar.305 #Elgar 305: Sold out!
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.307 #Elgar 307: Musical friendship
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.308 #Elgar 308: Musical rivalry
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.309 #Elgar 309: Inspirations
				days = { 14 21 }
			}
		}
		4 = { 
			trigger_event = {
				id = elgar.310 #Elgar 310: Mania
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.311 #Elgar 311: Music brings people together
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.315 #Elgar 315: A private concert
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.303 #Elgar 303: An amorous dedication
				days = { 14 21 }
			}
		}
		2 = { 
			trigger_event = {
				id = elgar.304 #Elgar 304: An evening reception (Monarchy)
				days = { 14 21 }
			}
		}
		1 = { 
			trigger_event = {
				id = elgar.313 #Elgar 313: A minor work
				days = { 14 21 }
			}
		}
	}
}

#############################

###Music tradition###

#Effect to add scaled $AMOUNT$ Music Tradition
elgar_add_x_music_tradition_effect = {
	# Amount = amount of music tradition to add
	if = { #This changes the Amount depending on the power rank.
		limit = { country_rank = rank_value:great_power }
		save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
			name = music_tradition_amount
			value = { #This is the way to calculate with temporary_scope_values. It is quite useful
				value = $AMOUNT$
				multiply = 0.5
				round = yes
			}
		}
	}
	else_if = {
		limit = { country_rank = rank_value:major_power }
		save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
			name = music_tradition_amount
			value = { #This is the way to calculate with temporary_scope_values. It is quite useful
				value = $AMOUNT$
				multiply = 0.75
				round = yes
			}
		}
	}
	else = { #In case that you are below major power you get all of the musical tradition
		save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
			name = music_tradition_amount
			value = $AMOUNT$
		}
	}
	
	#This part is used to display an accurate tooltip (Gain, loss, etc.)
	if = { #Negative Plural Tooltip if local_var is negative
		limit = { $AMOUNT$ < 0 }
		custom_tooltip = elgar_add_x_music_tradition_minus_x_tt
	}
	if = { #Neutral Tooltip if $AMOUNT$ is 0
		limit = { $AMOUNT$ = 0 }
		custom_tooltip = elgar_add_x_music_tradition_tradition_0_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ > 0 }
		custom_tooltip = elgar_add_x_music_tradition_plus_x_tt
	}

	#Yearly Music Tradition can be used for a report, they are added with each normal Music Tradition
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = elgar_yearly_music_tradition_var
			}
		}
		set_variable = {
			name = elgar_yearly_music_tradition_var
			value = 0
		}
	}
	change_variable = {
		name = elgar_yearly_music_tradition_var
		add = scope:music_tradition_amount
	}
	change_global_variable = {
		name = elgar_global_music_tradition_var
		add = scope:music_tradition_amount
	}

	#This part adds the AMOUNT of Music Tradition
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = elgar_music_tradition
			}
		}
		set_variable = {
			name = elgar_music_tradition
			value = 0
		}
	}
	change_variable = {
		name = elgar_music_tradition
		add = scope:music_tradition_amount
	}

	#elgar_composer_total_music_tradition_var is used to keep track of all the Music Tradition that a specific Writer created.
	#It is used to show how successful the Writer is.
	#Every time a normal Music Tradition Point is added, the same number gets added here.
	if = {
		limit = { #Only works if there actually is a Writer
			has_variable = elgar_composer_var
		}
		var:elgar_composer_var = {
			if = { #Fallback if the variable does not exist yet
				limit = {
					NOT = {
						has_variable = elgar_composer_total_music_tradition_var
					}
				}
				set_variable = {
					name = elgar_composer_total_music_tradition_var
					value = 0
				}
			}
			change_variable = { #The amount of Musical Tradition that this Composer discovered
				name = elgar_composer_total_music_tradition_var
				add = scope:music_tradition_amount
			}
		}
	}
}

#Effect to add unscaled $AMOUNT$ Music Tradition
elgar_add_x_music_tradition_unscaled_effect = {
	# Amount = amount of music tradition to add
	save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
		name = music_tradition_amount
		value = $AMOUNT$
	}
	
	#This part is used to display an accurate tooltip (Gain, loss, etc.)
	if = { #Negative Plural Tooltip if local_var is negative
		limit = { $AMOUNT$ < 0 }
		custom_tooltip = elgar_add_x_music_tradition_minus_x_tt
	}
	if = { #Neutral Tooltip if $AMOUNT$ is 0
		limit = { $AMOUNT$ = 0 }
		custom_tooltip = elgar_add_x_music_tradition_tradition_0_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ > 0 }
		custom_tooltip = elgar_add_x_music_tradition_plus_x_tt
	}

	#Yearly Music Tradition can be used for a report, they are added with each normal Music Tradition
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = elgar_yearly_music_tradition_var
			}
		}
		set_variable = {
			name = elgar_yearly_music_tradition_var
			value = 0
		}
	}
	change_variable = {
		name = elgar_yearly_music_tradition_var
		add = scope:music_tradition_amount
	}
	change_global_variable = {
		name = elgar_global_music_tradition_var
		add = scope:music_tradition_amount
	}

	#This part adds the AMOUNT of Music Tradition
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = elgar_music_tradition
			}
		}
		set_variable = {
			name = elgar_music_tradition
			value = 0
		}
	}
	change_variable = {
		name = elgar_music_tradition
		add = scope:music_tradition_amount
	}

	#elgar_composer_total_music_tradition_var is used to keep track of all the Music Tradition that a specific Writer created.
	#It is used to show how successful the Writer is.
	#Every time a normal Music Tradition Point is added, the same number gets added here.
	if = {
		limit = { #Only works if there actually is a Writer
			has_variable = elgar_composer_var
		}
		var:elgar_composer_var = {
			if = { #Fallback if the variable does not exist yet
				limit = {
					NOT = {
						has_variable = elgar_composer_total_music_tradition_var
					}
				}
				set_variable = {
					name = elgar_composer_total_music_tradition_var
					value = 0
				}
			}
			change_variable = { #The amount of Musical Tradition that this Composer discovered
				name = elgar_composer_total_music_tradition_var
				add = scope:music_tradition_amount
			}
		}
	}
}

##############################

###Scope Effects####

#Set Scope to elgar_conductor_scope
set_elgar_conductor_scope_effect = {
	var:elgar_composer_var = {
		save_scope_as = elgar_conductor
	}
}

#Set Scope to elgar_composer_scope
set_elgar_composer_scope_effect = {
	var:elgar_composer_var = {
		save_scope_as = elgar_composer_scope
	}
}

##############################

###Composer Progress

#Set Composer Progress to 0
set_elgar_composer_progress = {
	set_variable = {
 		name = elgar_composer_progress
 		value = 0
	}
}

#Effect to add $AMOUNT$ Composer Progress
elgar_add_x_composer_progress = {
	# Amount = amount of Statue of Composer Progress to add
	save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
		name = composer_progress_amount
		value = $AMOUNT$
	}

	#This part is used to display an accurate tooltip (Gain, loss, etc.)
	if = { #Negative Plural Tooltip if $AMOUNT$ is negative
		limit = { $AMOUNT$ < -1 }
		custom_tooltip = elgar_add_x_composer_progress_minus_x_tt
	}
	if = { #Negative Singular Tooltip if $AMOUNT$ is negative
		limit = { $AMOUNT$ = -1 }
		custom_tooltip = elgar_add_x_composer_progress_minus_1_tt
	}
	if = { #Neutral Tooltip if $AMOUNT$ is 0
		limit = { $AMOUNT$ = 0 }
		custom_tooltip = elgar_add_x_composer_progress_0_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ = 1 }
		custom_tooltip = elgar_add_x_composer_progress_plus_1_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ > 1 }
		custom_tooltip = elgar_add_x_composer_progress_plus_x_tt
	}

	#This part adds the AMOUNT of Composer Progress
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = elgar_composer_progress
			}
		}
		set_variable = {
			name = elgar_composer_progress
			value = 0
		}
	}
	change_variable = {
		name = elgar_composer_progress
		add = $AMOUNT$
	}
}

##############################

###Composer Achievements###

#Add Conductor seasons
elgar_add_elgar_composer_num_seasons_effect = {
	var:elgar_composer_var = {
		change_variable = {
			name = elgar_composer_num_seasons_var
			add = 1
		}
	}
}

#Add Compositions
elgar_add_elgar_composer_num_compositions_effect = {
	var:elgar_composer_var = {
		change_variable = {
			name = elgar_composer_num_compositions_var
			add = 1
		}
	}
}

#Add Tours
elgar_add_elgar_composer_num_tours_effect = {
	var:elgar_composer_var = {
		change_variable = {
			name = elgar_composer_num_tours_var
			add = 1
		}
	}
}

#Add Masterworks
elgar_add_elgar_composer_num_masterworks_effect = {
	var:elgar_composer_var = {
		change_variable = {
			name = elgar_composer_num_masterworks_var
			add = 1
		}
	}
}

##############################

###Composer Modifiers###

elgar_remove_composer_modifier_effect = {
	remove_modifier = elgar_composer_on_composing_modifier
	remove_modifier = elgar_composer_on_conducting_modifier
	remove_modifier = elgar_composer_on_tour_modifier
	remove_modifier = elgar_composer_on_masterpiece_modifier
}

##############################

###Composer Count###

#Counts how many Great Composers a country (This is used for the Swiss Elgar Achievement: As Switzerland, turn four Composers into Great Composers)
elgar_add_great_composer_count_effect = {
	change_variable = {
 		name = elgar_had_great_composers
 		add = 1
	}
}

##############################

###Composer Exhaustion###

#Calculate the days a Composer is unavailable
elgar_composer_exhaustion_add = {
	# DAYS = number of days for the modifier to last

	save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
		name = num_days
		value = { #This is the way to calculate with temporary_scope_values. It is quite useful
			value = $DAYS$
		}
	}

	custom_tooltip = {
		text = elgar_composer_exhaustion_add_tt
		add_modifier = {
			name = elgar_conductor_exhausted_modifier
			days = $DAYS$
		}
	}
}

##############################

###Musical Ranking###

#Creates a list of the ten countries with the highest musical tradition
#As this effect is called in an effect, it creates the list with normal variables
#Look at the customizable localizations to see how the countries are displayed.
#Basically the custom loc uses the variable to display both the countries in their order as well as the variables of those countries
elgar_create_musical_tradition_ranking_effect = {
	ordered_country = {
		limit = {
			NOT = { #Hopefully keeps revolutions to appear in the ranking
				is_revolutionary = yes
			}
		}
		order_by = var:elgar_music_tradition
		max = 10 #Limits the list to the ten top countires
		check_range_bounds = no #prevents errors

		#This part checks one after another whether the the first, second, etc. ranked countries are saved already.
		#Luckily the ordered_country effect iterates through the countries one after another.
		#So the first country gets saved to the first variable but as that variable now is set,
		# the second country gets saved to the second variable and so on.
		if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_1_var
					}
				}
			}
			root = {
				set_variable = { #The countries are actually saved to the country that uses the effect in the event window
					name = elgar_musical_tradition_rank_1_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_2_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_2_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_3_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_3_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_4_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_4_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_5_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_5_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_6_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_6_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_7_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_7_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_8_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_8_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_9_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_9_var
					value = prev
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					root = {
						has_variable = elgar_musical_tradition_rank_10_var
					}
				}
			}
			root = {
				set_variable = {
					name = elgar_musical_tradition_rank_10_var
					value = prev
				}
			}
		}
	}	
}

#Removes the ranking variables
elgar_remove_musical_tradition_ranking_variables = {
	remove_variable = elgar_musical_tradition_rank_1_var
	remove_variable = elgar_musical_tradition_rank_2_var
	remove_variable = elgar_musical_tradition_rank_3_var
	remove_variable = elgar_musical_tradition_rank_4_var
	remove_variable = elgar_musical_tradition_rank_5_var
	remove_variable = elgar_musical_tradition_rank_6_var
	remove_variable = elgar_musical_tradition_rank_7_var
	remove_variable = elgar_musical_tradition_rank_8_var
	remove_variable = elgar_musical_tradition_rank_9_var
	remove_variable = elgar_musical_tradition_rank_10_var
}

##############################

###Composer Tour###

#Sends Composer to the next country
elgar_composer_destination_effect = {
	ordered_country = {
		limit = {
			has_technology_researched = romanticism
			NOR = {
				has_modifier = elgar_composer_tour_performance_modifier
				has_modifier = elgar_had_composer_tour_performance_modifier
				has_modifier = elgar_composer_on_tour_modifier
			}
			NAND = {
				elgar_has_composer = yes
				var:elgar_composer_var = {
					has_modifier = elgar_conductor_touring_modifier
				}
			}
			NOT = {
				this = ROOT
			}
			NOT = {
				has_war_with = ROOT
			}
			NOT = {
				has_modifier = elgar_music_repression_modifier
			}
		}
		order_by = elgar_composer_destination_score
		max = 1
		check_range_bounds = no
		save_scope_as = elgar_composer_destination_scope
	}
}

#Determine touring composer
set_elgar_tour_composer_scope_effect = {
	random_country = {
		limit = {
			has_modifier = elgar_composer_on_tour_modifier
			has_variable = elgar_composer_var
		}
		var:elgar_composer_var = {
			save_scope_as = elgar_composer_scope
		}
	}
}

#Sends Liszt to the next country
elgar_liszt_destination_effect = {
	ordered_country = {
		limit = {
			has_technology_researched = romanticism
			country_is_in_europe = yes
			NOT = {
				this = ROOT
			}
			NOT = {
				any_scope_state = {
					has_modifier = elgar_liszt_was_here_modifier
				}
			}
		}
		order_by = elgar_liszt_destination_score
		max = 1
		check_range_bounds = no
		save_scope_as = elgar_liszt_destination_scope
	}
}

##############################

###Top 5 Ranking for Composers###

#Adds the 5 best composers as global variables
elgar_create_composer_ranking_effect = {
	remove_global_variable = elgar_composer_rank_1_global_var
	remove_global_variable = elgar_composer_rank_2_global_var
	remove_global_variable = elgar_composer_rank_3_global_var
	remove_global_variable = elgar_composer_rank_4_global_var
	remove_global_variable = elgar_composer_rank_5_global_var

	every_character_in_void = {
		limit = {
			OR = {
				has_variable = mr_is_composer_var
				has_variable = mr_is_travelling_composer_var
				NOT = { has_variable = elgar_composer_experience }
			}
		}
		set_variable = {
			name = elgar_composer_experience
			value = 0
		}
	}

	ordered_character_in_void = {
		limit = {
			OR = {
				has_variable = mr_is_composer_var
				has_variable = mr_is_travelling_composer_var
			}
		}

		order_by = var:elgar_composer_experience
		max = 5
		check_range_bounds = no

		if = {
			limit = {
				NOT = {
					has_global_variable = elgar_composer_rank_1_global_var
				}
			}
			set_global_variable = {
				name = elgar_composer_rank_1_global_var
				value = this
			}
		}
		else_if = {
			limit = {
				NOT = {
					has_global_variable = elgar_composer_rank_2_global_var
				}
			}
			set_global_variable = {
				name = elgar_composer_rank_2_global_var
				value = this
			}
		}
		else_if = {
			limit = {
				NOT = {
					has_global_variable = elgar_composer_rank_3_global_var
				}
			}
			set_global_variable = {
				name = elgar_composer_rank_3_global_var
				value = this
			}
		}
		else_if = {
			limit = {
				NOT = {
					has_global_variable = elgar_composer_rank_4_global_var
				}
			}
			set_global_variable = {
				name = elgar_composer_rank_4_global_var
				value = this
			}
		}
		else_if = {
			limit = {
				NOT = {
					has_global_variable = elgar_composer_rank_5_global_var
				}
			}
			set_global_variable = {
				name = elgar_composer_rank_5_global_var
				value = this
			}
		}
	}
}

##############################

###Elgar Variables###

#Add variables
elgar_add_variables = {
	set_variable = {
        name = elgar_music_tradition
        value = 0
	}
	set_variable = {
        name = elgar_had_great_composers
        value = 0
	}
	set_variable = elgar_variables_var
}