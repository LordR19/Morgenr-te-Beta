###########################
# ANZONI SCRIPTED EFFECTS #
###########################

#by Marco Dandolo & Lord R

##########################


######ADD LITERARY TRADITION######

#Effect to add $AMOUNT$ Literary Tradition
manzoni_add_x_literary_tradition_effect = {
	# Amount = amount of literary tradition to add
	if = { #This changes the Amount depending on the power rank.
		limit = { country_rank = rank_value:great_power }
		save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
			name = literary_tradition_amount
			value = { #This is the way to calculate with temporary_scope_values. It is quite useful
				value = $AMOUNT$
				multiply = 0.5
				round = yes
			}
		}
	}
	else_if = {
		limit = { country_rank = rank_value:major_power }
		save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
			name = literary_tradition_amount
			value = { #This is the way to calculate with temporary_scope_values. It is quite useful
				value = $AMOUNT$
				multiply = 0.75
				round = yes
			}
		}
	}
	else = { #In case that you are below major power you get all of the musical tradition
		save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
			name = literary_tradition_amount
			value = $AMOUNT$
		}
	}
	
	#This part is used to display an accurate tooltip (Gain, loss, etc.)
	if = { #Negative Plural Tooltip if local_var is negative
		limit = { $AMOUNT$ < 0 }
		custom_tooltip = manzoni_add_x_literary_tradition_minus_x_tt
	}
	if = { #Neutral Tooltip if $AMOUNT$ is 0
		limit = { $AMOUNT$ = 0 }
		custom_tooltip = manzoni_add_x_literary_tradition_0_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ > 0 }
		custom_tooltip = manzoni_add_x_literary_tradition_plus_x_tt
	}

	#Yearly Literary Tradition can be used for a report, they are added with each normal Literary Tradition
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = manzoni_yearly_literary_tradition_var
			}
		}
		set_variable = {
			name = manzoni_yearly_literary_tradition_var
			value = 0
		}
	}
	change_variable = {
		name = manzoni_yearly_literary_tradition_var
		add = scope:literary_tradition_amount
	}
	change_global_variable = {
		name = manzoni_global_literary_tradition_var
		add = scope:literary_tradition_amount
	}

	#This part adds the AMOUNT of Literary Tradition
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = manzoni_literary_tradition_var
			}
		}
		set_variable = {
			name = manzoni_literary_tradition_var
			value = 0
		}
	}
	change_variable = {
		name = manzoni_literary_tradition_var
		add = scope:literary_tradition_amount
	}

	#manzoni_writer_total_literary_tradition_var is used to keep track of all the Literary Tradition that a specific Writer created.
	#It is used to show how successful the Writer is.
	#Every time a normal Literary Tradition Point is added, the same number gets added here.
	if = {
		limit = { #Only works if there actually is a Writer
			has_variable = manzoni_writer_var
		}
		var:manzoni_writer_var = {
			if = { #Fallback if the variable does not exist yet
				limit = {
					NOT = {
						has_variable = manzoni_writer_total_literary_tradition_var
					}
				}
				set_variable = {
					name = manzoni_writer_total_literary_tradition_var
					value = 0
				}
			}
			change_variable = { #The amount of Literary Tradition that this Writer created
				name = manzoni_writer_total_literary_tradition_var
				add = scope:literary_tradition_amount
			}
		}
	}
}

######ADD BESTSELLERS######

#Effect to add $AMOUNT$ Bestseller
manzoni_add_x_bestseller_effect = {
	# Amount = amount of Bestsellers Progress to add
	save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
		name = bestseller_amount
		value = $AMOUNT$
	}

	#This part is used to display an accurate tooltip (Gain, loss, etc.)
	if = { #Negative Plural Tooltip if $AMOUNT$ is negative
		limit = { $AMOUNT$ < -1 }
		custom_tooltip = manzoni_add_x_bestsellers_minus_x_tt
	}
	if = { #Negative Singular Tooltip if $AMOUNT$ is negative
		limit = { $AMOUNT$ = -1 }
		custom_tooltip = manzoni_add_x_bestsellers_minus_1_tt
	}
	if = { #Neutral Tooltip if $AMOUNT$ is 0
		limit = { $AMOUNT$ = 0 }
		custom_tooltip = manzoni_add_x_bestsellers_0_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ = 1 }
		custom_tooltip = manzoni_add_x_bestsellers_plus_1_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ > 1 }
		custom_tooltip = manzoni_add_x_bestsellers_plus_x_tt
	}

	#This part adds the AMOUNT of National Identity Progress
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = manzoni_num_bestsellers_var
			}
		}
		set_variable = {
			name = manzoni_num_bestsellers_var
			value = 0
		}
	}
	change_variable = {
		name = manzoni_num_bestsellers_var
		add = $AMOUNT$
	}
}

######ADD NATIONAL IDENTITY PROGRESS######

#Effect to add $AMOUNT$ National Identity Progress
manzoni_add_x_national_identity_progress_effect = {
	# Amount = amount of National Identity Progress to add
	save_temporary_scope_value_as = { #This is used to display the amount in the tooltip
		name = national_identity_progress_amount
		value = $AMOUNT$
	}

	#This part is used to display an accurate tooltip (Gain, loss, etc.)
	if = { #Negative Plural Tooltip if $AMOUNT$ is negative
		limit = { $AMOUNT$ < -1 }
		custom_tooltip = manzoni_add_x_national_identity_progress_minus_x_tt
	}
	if = { #Negative Singular Tooltip if $AMOUNT$ is negative
		limit = { $AMOUNT$ = -1 }
		custom_tooltip = manzoni_add_x_national_identity_progress_minus_1_tt
	}
	if = { #Neutral Tooltip if $AMOUNT$ is 0
		limit = { $AMOUNT$ = 0 }
		custom_tooltip = manzoni_add_x_national_identity_progress_0_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ = 1 }
		custom_tooltip = manzoni_add_x_national_identity_progress_plus_1_tt
	}
	if = { #Positive Plural Tooltip if $AMOUNT$ is positive
		limit = { $AMOUNT$ > 1 }
		custom_tooltip = manzoni_add_x_national_identity_progress_plus_x_tt
	}

	#This part adds the AMOUNT of National Identity Progress
	if = { #Fallback if the variable does not exist yet
		limit = {
			NOT = {
				has_variable = national_identity_progress_var
			}
		}
		set_variable = {
			name = national_identity_progress_var
			value = 0
		}
	}
	change_variable = {
		name = national_identity_progress_var
		add = $AMOUNT$
	}
}

######AUDIENCE TASTE#######

#Change Audience Taste every 10 years
manzoni_taste_change_effect = {
	random_list = {
		###Audience taste changes to Juvenile Literature
		1 = {
			modifier = {
				if = {
					limit = {
						has_variable = manzoni_taste_juvenile_var
					}
					add = -1000
				}
				if = {
					limit = {
						has_law = law_type:law_restricted_child_labor
					}
					add = 1
				}
				if = {
					limit = {
						has_law = law_type:law_compulsory_primary_school
					}
					add = 2
				}
				if = {
					limit = {
						NOT = {
							has_law = law_type:law_no_schools
						}
					}
					add = 1
				}
			}
			manzoni_remove_taste_effect = yes
			set_variable = manzoni_taste_juvenile_var
		}
		###Audience taste changes to Crime&Mystery###
		1 = {
			modifier = {
				if = {
					limit = {
						has_variable = manzoni_taste_crime_var
					}
					add = -1000
				}
				if = {
					limit = {
						has_game_rule = lepsius_historical_and_fictional_rule
					}
					add = 1
				}
				if = {
					limit = {
						lepsius_has_clue = yes
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							ig:ig_petty_bourgeoisie = {
								is_powerful = yes
							}
							ig:ig_petty_bourgeoisie = {
								is_in_government = yes
							}
						}
					}
					add = 1
				}
				if = {
					limit = {
						ig:ig_petty_bourgeoisie = {
							ig_approval >= 5
						}
					}
					add = 1
				}
			}
			manzoni_remove_taste_effect = yes
			set_variable = manzoni_taste_crime_var
		}
		###Audience taste changes to Adventure Stories###
		1 = {
			modifier = {
				if = {
					limit = {
						has_variable = manzoni_taste_adventure_var
					}
					add = -1000
				}
				if = {
					limit = {
						country_rank >= rank_value:major_power
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							lepsius_on_archaeological_excavation = yes
							lepsius_on_archaeological_expedition = yes
							has_modifier = lepsius_had_expedition_modifier
						}
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							has_modifier = rapanui_pacific_expedition_modifier
							has_modifier = rapanui_had_pacific_expedition_modifier
						}
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							dubois_has_naturalist = yes
							dubois_has_paleontologist = yes
							lepsius_has_archaeologist = yes
						}
					}
					add = 1
				}
			}
			manzoni_remove_taste_effect = yes
			set_variable = manzoni_taste_adventure_var
		}
		###Audience taste changes to Science-Fiction###
		1 = {
			modifier = {
				if = {
					limit = {
						has_variable = manzoni_taste_science_var
					}
					add = -1000
				}
				if = {
					limit = {
						verrier_astronomical_observation = yes
						OR = {
							verrier_has_astronomer = yes
							gaudi_has_engineer = yes
						}
					}
					add = 1
				}
				if = {
					limit = {
						NOR = {
							has_law = law_type:law_traditionalism
							has_law = law_type:law_agrarianism
						}
					}
					add = 1
				}
				if = {
					limit = {
						literacy_rate >= 0.5
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							ig:ig_industrialists = {
								is_powerful = yes
							}
							ig:ig_industrialists = {
								is_in_government = yes
							}
						}
					}
					add = 1
				}
			}
			manzoni_remove_taste_effect = yes
			set_variable = manzoni_taste_science_var
		}
		###Audience taste changes to Social Criticism###
		1 = {
			modifier = {
				if = {
					limit = {
						has_variable = manzoni_taste_social_var
					}
					add = -1000
				}
				if = {
					limit = {
						has_law = law_type:law_protected_speech
					}
					add = 1
				}
				if = {
					limit = {
						has_law = law_type:law_universal_suffrage
					}
					add = 1
				}
				if = {
					limit = {
						ig:ig_intelligentsia = {
							ig_approval < 0
						}
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							ig:ig_trade_unions = {
								is_powerful = yes
							}
							ig:ig_trade_unions = {
								is_in_government = yes
							}
						}
					}
					add = 1
				}
			}
			manzoni_remove_taste_effect = yes
			set_variable = manzoni_taste_social_var
		}
		###Audience taste changes to Literary Fiction###
		1 = {
			modifier = {
				if = {
					limit = {
						has_variable = manzoni_taste_literary_var
					}
					add = -1000
				}
				if = {
					limit = {
						klimt_has_painter = yes
						elgar_has_composer = yes
					}
					add = 1
				}
				if = {
					limit = {
						literacy_rate >= 0.66
					}
					add = 1
				}
				if = {
					limit = {
						ig:ig_intelligentsia = {
							ig_approval >= 10
						}
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							ig:ig_intelligentsia = {
								is_powerful = yes
							}
							ig:ig_intelligentsia = {
								is_in_government = yes
							}
						}
					}
					add = 1
				}
			}
			manzoni_remove_taste_effect = yes
			set_variable = manzoni_taste_literary_var
		}
		###Audience taste changes to Devotional Literature###
		1 = {
			modifier = {
				if = {
					limit = {
						has_variable = manzoni_taste_devotional_var
					}
					add = -1000
				}
				if = {
					limit = {
						has_law = law_type:law_theocracy
					}
					add = 1
				}
				if = {
					limit = {
						has_law = law_type:law_state_religion
					}
					add = 1
				}
				if = {
					limit = {
						literacy_rate < 0.35
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							ig:ig_devout = {
								is_powerful = yes
							}
							ig:ig_devout = {
								is_in_government = yes
							}
						}
					}
					add = 1
				}
			}
			manzoni_remove_taste_effect = yes
			set_variable = manzoni_taste_devotional_var
		}
		###Audience taste changes to Romance###
		1 = {
			modifier = {
				if = {
					limit = {
						has_variable = manzoni_taste_romance_var
					}
					add = -1000
				}
				if = {
					limit = {
						OR = {
							is_at_war = yes
							has_revolution = yes
						}
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							has_law = law_type:law_single_party_state
							has_law = law_type:law_autocracy
							has_law = law_type:law_secret_police
						}
					}
					add = 1
				}
				if = {
					limit = {
						has_technology_researched = elgar_mass_culture_tech
					}
					add = 1
				}
				if = {
					limit = {
						OR = {
							ig:ig_landowners = {
								is_powerful = yes
							}
							ig:ig_landowners = {
								is_in_government = yes
							}
						}
					}
					add = 1
				}
			}
			manzoni_remove_taste_effect = yes
			set_variable = manzoni_taste_romance_var
		}
	}
	###Trigger Notification for Player###
	if = {
		limit = {
			is_player = yes
		}
		trigger_event = { 
			id = manzoni.3 #New Audience taste
		}
	}
}

#Remove Audience Taste
manzoni_remove_taste_effect = {
	remove_variable = manzoni_taste_juvenile_var
	remove_variable = manzoni_taste_crime_var
	remove_variable = manzoni_taste_adventure_var
	remove_variable = manzoni_taste_science_var
	remove_variable = manzoni_taste_social_var
	remove_variable = manzoni_taste_literary_var
	remove_variable = manzoni_taste_devotional_var
	remove_variable = manzoni_taste_romance_var
}

##############################

###Local Writer Effects###

#This effect sets a local writer with a genre corresponding to the current taste as a scope
manzoni_local_writer_meets_taste_scope_effect = {
	random_in_list = {
		variable = mr_local_writers_list
		limit = {
			OR = {
				AND = {
					root = {
						has_variable = manzoni_taste_adventure_var
					}
					has_trait = manzoni_genre_adventure
				}
				AND = {
					root = {
						has_variable = manzoni_taste_crime_var
					}
					has_trait = manzoni_genre_crime_mystery
				}
				AND = {
					root = {
						has_variable = manzoni_taste_devotional_var
					}
					has_trait = manzoni_genre_devout
				}
				AND = {
					root = {
						has_variable = manzoni_taste_juvenile_var
					}
					has_trait = manzoni_genre_juvenile
				}
				AND = {
					root = {
						has_variable = manzoni_taste_literary_var
					}
					has_trait = manzoni_genre_literary_fiction
				}
				AND = {
					root = {
						has_variable = manzoni_taste_romance_var
					}
					has_trait = manzoni_genre_romance
				}
				AND = {
					root = {
						has_variable = manzoni_taste_science_var
					}
					has_trait = manzoni_genre_science_fiction
				}
				AND = {
					root = {
						has_variable = manzoni_taste_social_var
					}
					has_trait = manzoni_genre_social_critic
				}
			}
		}
		save_scope_as = manzoni_writer_scope
	}
}

#This effect sets a local writer with a genre close to the current taste as a scope
manzoni_local_writer_close_to_taste_scope_effect = {
	random_in_list = {
		variable = mr_local_writers_list
		limit = {
			trigger_if = {
				limit = { has_variable = manzoni_taste_adventure_var }
				OR = {
					has_trait = manzoni_genre_science_fiction
					has_trait = manzoni_genre_juvenile
					has_trait = manzoni_genre_crime_mystery
				}
			}
			trigger_if = {
				limit = { has_variable = manzoni_taste_crime_var }
				OR = {
					has_trait = manzoni_genre_science_fiction
					has_trait = manzoni_genre_adventure
					has_trait = manzoni_genre_romance
				}
			}
			trigger_if = {
				limit = { has_variable = manzoni_taste_devotional_var }
				OR = {
					has_trait = manzoni_genre_juvenile
					has_trait = manzoni_genre_romance
					has_trait = manzoni_genre_adventure
				}
			}
			trigger_if = {
				limit = { has_variable = manzoni_taste_juvenile_var }
				has_variable_list = mr_local_writers_list
				OR = {
					has_trait = manzoni_genre_adventure
					has_trait = manzoni_genre_devout
					has_trait = manzoni_genre_crime_mystery
				}
			}
			trigger_if = {
				limit = { has_variable = manzoni_taste_literary_var }
				OR = {
					has_trait = manzoni_genre_social_critic
					has_trait = manzoni_genre_science_fiction
					has_trait = manzoni_genre_romance
				}
			}
			trigger_if = {
				limit = { has_variable = manzoni_taste_romance_var }
				OR = {
					has_trait = manzoni_genre_devout
					has_trait = manzoni_genre_juvenile
					has_trait = manzoni_genre_literary_fiction
				}
			}
			trigger_if = {
				limit = { has_variable = manzoni_taste_science_var }
				OR = {
					has_trait = manzoni_genre_adventure
					has_trait = manzoni_genre_social_critic
					has_trait = manzoni_genre_literary_fiction
				}
			}
			trigger_if = {
				limit = { has_variable = manzoni_taste_social_var }
				OR = {
					has_trait = manzoni_genre_literary_fiction
					has_trait = manzoni_genre_juvenile
					has_trait = manzoni_genre_crime_mystery
				}
			}
		}
		save_scope_as = manzoni_writer_scope
	}
}

##############################

###General writer effects###

manzoni_check_character_crime_mystery_effect = {
	if = {
		limit = {
			has_trait = manzoni_genre_crime_mystery
			NOR = {
				has_variable = manzoni_mystery_writer_var
				has_variable = manzoni_crime_writer_var
			}
		}
		random_list = {
			1 = { set_variable = manzoni_crime_writer_var }
			1 = { set_variable = manzoni_mystery_writer_var }
		}
	}
}

manzoni_randomize_bestseller_title_effect = {
	set_variable = {
		name = manzoni_bestseller_title_var
		value = {
			value = { 0 15 }
			ceiling = yes
		}
	}
}

##############################

###Manzoni Variables###

#Add variables
manzoni_add_variables = {
	set_variable = {
        name = manzoni_literary_tradition_var
        value = 0
	}
	set_variable = manzoni_variables_var
}
