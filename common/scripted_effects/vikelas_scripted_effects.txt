############################
# VIKELAS SCRIPTED EFFECTS #
############################

#by Lord R

#############################

###Medal Effects###

#This effect adds all the medals to the correct countries
vikelas_add_medals_effect = {

	### Countries with best Scores ###
	set_local_variable = {
		name = best_three_nations_local_var
		value = 3
	}
	ordered_country = {
		limit = {
			#TODO add a restriction to countries participating at the games
		}
		order_by = vikelas_olympic_success_value
		max = 3

		set_variable = {
			name = vikelas_gold_medals_this_year_var
			value = local_var:best_three_nations_local_var
		}
		if = {
			limit = {
				NOT = { has_variable = vikelas_gold_medals_var }
			}
			set_variable = {
				name = vikelas_gold_medals_var
				value = 0
			}
		}
		change_variable = {
			name = vikelas_gold_medals_var
			add = local_var:best_three_nations_local_var
		}
		change_local_variable = {
			name = best_three_nations_local_var
			add = -1
		}
	}

	### Random participant countries ###
	while = {
		count = 4 #Hands out 4 medals

		#Chooses whether all nations have a chance or only smaller nations
		random_list = {
			3 = { #All nations
				random_country = {
					limit = {  } #TODO add participant limit
					if = {
						limit = {
							NOT = { has_variable = vikelas_gold_medals_this_year_var }
						}
						set_variable = {
							name = vikelas_gold_medals_this_year_var
							value = 1
						}
					}
					else = {
						change_variable = {
							name = vikelas_gold_medals_this_year_var
							add = 1
						}
					}
					if = {
						limit = {
							NOT = { has_variable = vikelas_gold_medals_var }
						}
						set_variable = {
							name = vikelas_gold_medals_var
							value = 1
						}
					}
					else = {
						change_variable = {
							name = vikelas_gold_medals_var
							add = 1
						}
					}
				}
			}
			7 = { #Small nations
				trigger = {
					any_country = {
						#TODO add participant limit
						country_rank <= rank_value:major_power
					}
				}

				random_country = {
					limit = {
						#TODO add participant limit
						country_rank <= rank_value:major_power
					}
					if = {
						limit = {
							NOT = { has_variable = vikelas_gold_medals_this_year_var }
						}
						set_variable = {
							name = vikelas_gold_medals_this_year_var
							value = 1
						}
					}
					else = {
						change_variable = {
							name = vikelas_gold_medals_this_year_var
							add = 1
						}
					}
					if = {
						limit = {
							NOT = { has_variable = vikelas_gold_medals_var }
						}
						set_variable = {
							name = vikelas_gold_medals_var
							value = 1
						}
					}
					else = {
						change_variable = {
							name = vikelas_gold_medals_var
							add = 1
						}
					}
				}
			}
		}
	}

	### Sailing Medals ###
	if = {
		limit = {
			any_country = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = expert_naval_commander
						has_trait = expert_convoy_raider
					}
				}
			}
		}
		random_country = {
			limit = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = expert_naval_commander
						has_trait = expert_convoy_raider
					}
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_this_year_var }
				}
				set_variable = {
					name = vikelas_gold_medals_this_year_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_this_year_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_var }
				}
				set_variable = {
					name = vikelas_gold_medals_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_var
					add = 1
				}
			}
		}
	}
	else_if = {
		limit = {
			any_country = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = experienced_naval_commander
						has_trait = experienced_convoy_raider
					}
				}
			}
		}
		random_country = {
			limit = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = experienced_naval_commander
						has_trait = experienced_convoy_raider
					}
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_this_year_var }
				}
				set_variable = {
					name = vikelas_gold_medals_this_year_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_this_year_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_var }
				}
				set_variable = {
					name = vikelas_gold_medals_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_var
					add = 1
				}
			}
		}
	}
	else_if = {
		limit = {
			any_country = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = basic_naval_commander
						has_trait = convoy_raider_commander
					}
				}
			}
		}
		random_country = {
			limit = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = basic_naval_commander
						has_trait = convoy_raider_commander
					}
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_this_year_var }
				}
				set_variable = {
					name = vikelas_gold_medals_this_year_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_this_year_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_var }
				}
				set_variable = {
					name = vikelas_gold_medals_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_var
					add = 1
				}
			}
		}
	}
	else = {
		random_country = {
			limit = {
				#TODO add participant limit
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_this_year_var }
				}
				set_variable = {
					name = vikelas_gold_medals_this_year_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_this_year_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_var }
				}
				set_variable = {
					name = vikelas_gold_medals_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_var
					add = 1
				}
			}
		}
	}

	### Shooting Medals ###
	if = {
		limit = {
			any_country = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = expert_offensive_planner
						has_trait = expert_defensive_strategist
					}
				}
			}
		}
		random_country = {
			limit = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = expert_offensive_planner
						has_trait = expert_defensive_strategist
					}
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_this_year_var }
				}
				set_variable = {
					name = vikelas_gold_medals_this_year_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_this_year_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_var }
				}
				set_variable = {
					name = vikelas_gold_medals_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_var
					add = 1
				}
			}
		}
	}
	else_if = {
		limit = {
			any_country = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = experienced_offensive_planner
						has_trait = experienced_defensive_strategist
					}
				}
			}
		}
		random_country = {
			limit = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = experienced_offensive_planner
						has_trait = experienced_defensive_strategist
					}
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_this_year_var }
				}
				set_variable = {
					name = vikelas_gold_medals_this_year_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_this_year_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_var }
				}
				set_variable = {
					name = vikelas_gold_medals_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_var
					add = 1
				}
			}
		}
	}
	else_if = {
		limit = {
			any_country = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = basic_offensive_planner
						has_trait = basic_defensive_strategist
					}
				}
			}
		}
		random_country = {
			limit = {
				#TODO add participant limit
				any_scope_character = {
					OR = {
						has_trait = basic_offensive_planner
						has_trait = basic_defensive_strategist
					}
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_this_year_var }
				}
				set_variable = {
					name = vikelas_gold_medals_this_year_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_this_year_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_var }
				}
				set_variable = {
					name = vikelas_gold_medals_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_var
					add = 1
				}
			}
		}
	}
	else = {
		random_country = {
			limit = {
				#TODO add participant limit
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_this_year_var }
				}
				set_variable = {
					name = vikelas_gold_medals_this_year_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_this_year_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { has_variable = vikelas_gold_medals_var }
				}
				set_variable = {
					name = vikelas_gold_medals_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = vikelas_gold_medals_var
					add = 1
				}
			}
		}
	}
}