### PHYSICIAN BUTTONS ###

#by Lord R & Marco Dandolo

#Does the country have a physician
mr_has_physician_sgui = {
	scope = country
	is_shown = {
		has_variable = panum_physician_var
	}
}

#MR_PHYSICIAN_DESCRIBE_DISEASE_BUTTON
mr_physician_describe_disease_button = {
    scope = country
    is_valid = {
		hidden_trigger = {
			NOT = {
				has_variable = panum_physician_action_active_var
			}
		}
		custom_tooltip = {
			text = MR_ACTIVE_PHYSICIAN_TRIGGER
			has_variable = panum_physician_var
			var:panum_physician_var = {
				is_busy = no
			}
		}
		custom_tooltip = {
			text = MR_PHYSICIAN_CAN_DESCRIBE_LOCAL_DISEASE_TRIGGER_TT
			panum_can_describe_local_disease_trigger = yes
		}
    }
    effect = {
		set_variable = panum_physician_action_active_var
		set_variable = panum_physician_describe_disease_active_var
		trigger_event = { 
			id = panum.51
			popup = yes 
		}
    }
}
#Checks if this is button is active
mr_physician_describe_disease_active = {
	is_shown = {
		has_variable = panum_physician_describe_disease_active_var
	}
}

#MR_PHYSICIAN_DESCRIBE_DISEASE_FOREIGN_BUTTON
mr_physician_describe_disease_foreign_button = {
    scope = country
    is_valid = {
		hidden_trigger = {
			NOT = {
				has_variable = panum_physician_action_active_var
			}
		}
		custom_tooltip = {
			text = MR_ACTIVE_PHYSICIAN_TRIGGER
			has_variable = panum_physician_var
			var:panum_physician_var = {
				is_busy = no
			}
		}
		custom_tooltip = {
			text = MR_PHYSICIAN_CAN_DESCRIBE_FOREIGN_DISEASE_TRIGGER_TT
			panum_can_describe_foreign_disease_trigger = yes
		}
		custom_tooltip = {
			text = MR_CIVILIZING_MISSION_TECH_TRIGGER_TT
			has_technology_researched = civilizing_mission
		}
    }
    effect = {
		set_variable = panum_physician_action_active_var
		set_variable = panum_physician_describe_disease_foreign_active_var
		trigger_event = { 
			id = panum.52
			popup = yes
		}
    }
}
#Checks if this is button is active
mr_physician_describe_disease_foreign_active = {
	is_shown = {
		has_variable = panum_physician_describe_disease_foreign_active_var
	}
}

#MR_PHYSICIAN_FIND_TREATMENT_BUTTON
mr_physician_find_treatment_button = {
    scope = country
    is_valid = {
		hidden_trigger = {
			NOT = {
				has_variable = panum_physician_action_active_var
			}
		}
		custom_tooltip = {
			text = MR_ACTIVE_PHYSICIAN_TRIGGER
			has_variable = panum_physician_var
			var:panum_physician_var = {
				is_busy = no
			}
		}
		custom_tooltip = {
			text = MR_PHYSICIAN_CAN_FIND_LOCAL_TREATMENT_TRIGGER_TT
			panum_can_find_local_treatment_trigger = yes
		}
    }
    effect = {
		set_variable = panum_physician_action_active_var
		set_variable = panum_physician_find_treatment_active_var
		trigger_event = { 
			id = panum.53
			popup = yes 
		}
    }
}
#Checks if this is button is active
mr_physician_find_treatment_active = {
	is_shown = {
		has_variable = panum_physician_find_treatment_active_var
	}
}

#MR_PHYSICIAN_FIND_TREATMENT_FOREIGN_BUTTON
mr_physician_find_treatment_foreign_button = {
    scope = country
    is_valid = {
		hidden_trigger = {
			NOT = {
				has_variable = panum_physician_action_active_var
			}
		}
		custom_tooltip = {
			text = MR_ACTIVE_PHYSICIAN_TRIGGER
			has_variable = panum_physician_var
			var:panum_physician_var = {
				is_busy = no
			}
		}
		custom_tooltip = {
			text = MR_PHYSICIAN_CAN_FIND_FOREIGN_TREATMENT_TRIGGER_TT
			panum_can_find_foreign_treatment_trigger = yes
		}
		custom_tooltip = {
			text = MR_CIVILIZING_MISSION_TECH_TRIGGER_TT
			has_technology_researched = civilizing_mission
		}
    }
    effect = {
		set_variable = panum_physician_action_active_var
		set_variable = panum_physician_find_treatment_foreign_active_var
		trigger_event = { 
			id = panum.54
			popup = yes 
		}
    }
}
#Checks if this is button is active
mr_physician_find_treatment_foreign_active = {
	is_shown = {
		has_variable = panum_physician_find_treatment_foreign_active_var
	}
}

#MR_PHYSICIAN_EXPAND_MEDICAL_SYSTEM_BUTTON
mr_physician_expand_medical_system_button = {
    scope = country
    is_valid = {
		hidden_trigger = {
			NOT = {
				has_variable = panum_physician_action_active_var
			}
		}
		custom_tooltip = {
			text = MR_ACTIVE_PHYSICIAN_TRIGGER
			has_variable = panum_physician_var
			var:panum_physician_var = {
				is_busy = no
			}
		}
		custom_tooltip = {
			text = MR_PHYSICIAN_HAS_HEALTH_SYSTEM_TRIGGER_TT
			NOT = {
				has_law = law_type:law_no_health_system
			}
		}
		custom_tooltip = {
			text = MR_PHYSICIAN_HAS_HEALTH_SYSTEM_INSTITUTION_TRIGGER_TT
			institution_investment_level = {
				institution	= institution_health_system
				value >= 1
			}
		}
		OR = {
			custom_tooltip = {
				text = MR_PHYSICIAN_HAS_POSSIBLE_CLINIC_TRIGGER_TT
				any_scope_state = {
					any_scope_building = {
						is_building_type = building_government_administration
						level >= 5
						has_active_production_method = pm_panum_no_clinic
					}
				}
			}
			custom_tooltip = {
				text = MR_PHYSICIAN_HAS_POSSIBLE_HOSPITAL_TRIGGER_TT
				any_scope_state = {
					any_scope_building = {
						is_building_type = building_government_administration
						level >= 20
						has_active_production_method = pm_panum_clinic
					}
				}
			}
		}
    }
    effect = {
		set_variable = mr_physician_expand_medical_system_var
		add_modifier = {
			name = panum_medical_system_cost_modifier
			multiplier = money_amount_multiplier_small
		}
		add_journal_entry = { type = je_panum_medical_system_project }
		if = {
			limit = {
				has_variable = panum_physician_var
			}
			var:panum_physician_var = {
				set_character_busy_and_immortal = yes
			}
		}
    }
}
#Checks if this is button is active
mr_physician_expand_medical_system_active = {
	is_shown = {
		has_variable = mr_physician_expand_medical_system_var
	}
}

#MR_PHYSICIAN_MEDICAL_RESEARCH_BUTTON
mr_physician_medical_research_button = {
	scope = country
	custom_tooltip = {
		text = MR_ACTIVE_PHYSICIAN_TRIGGER
		has_variable = panum_physician_var
		var:panum_physician_var = {
			is_busy = no
		}
	}
	effect = {
		set_variable = mr_physician_medical_research_var
		add_modifier = {
			name = panum_medical_research_cost_modifier
			multiplier = money_amount_multiplier_small
		}
		add_journal_entry = { type = je_panum_medical_research_project }
		if = {
			limit = {
				has_variable = panum_physician_var
			}
			var:panum_physician_var = {
				set_character_busy_and_immortal = yes
			}
		}
	}
}
#Active
mr_physician_medical_research_active = {
	scope = country
	is_shown = {
		has_variable = mr_physician_medical_research_var
	}
}

#MR_MEDICAL_CONGRESS_BUTTON
mr_medical_congress_button = {
    scope = country
    is_valid = {
		custom_tooltip = {
			text = MR_HAS_PHYSICIAN_TRIGGER
			has_variable = panum_physician_var
		}
		custom_tooltip = {
			text = MR_MEDICAL_CONGRESS_PHARMACEUTICALS_TECH_TRIGGER_TT
			has_technology_researched = pharmaceuticals
		}
		custom_tooltip = {
			text = MR_MEDICINE_8_COUNTRIES_WITH_PHYSICIAN_TRIGGER_TT
			any_country = {
				panum_has_physician = yes
				count >= 8
			}
		}
		custom_tooltip = {
			text = MR_ASTEROID_CONGRESS_UNIVERSITY_BUILDING_TRIGGER_TT
			country_has_building_type_levels = {  
				target = bt:building_university  
				value  >= 5
			}
		}
		custom_tooltip = {
			text = MR_MEDICAL_AVANTGARDE_TRIGGER_TT
			has_modifier = panum_medical_avant_garde_modifier
		}
		custom_tooltip = {
			text = MR_MEDICAL_CONGRESS_COOLDOWN_TRIGGER_TT
			NOT = {
				any_country = {
					has_modifier = panum_congress_host_modifier
				}
			}
		}
    }
    effect = {
		trigger_event = { 
			id = panum.2000
			popup = yes 
		}
		add_modifier = {
			name = panum_congress_host_modifier
			years = 5
		}	
    }

	ai_is_valid = { always = yes }	# Whether this SGUI is available to the AI or not (default false)
	ai_chance = {
		base = 100 # The chance that the AI will activate this SGUI (script value between 1 and 100)
	}
	ai_frequency = 6 # Named value determining how frequently the AI will evaluate this SGUI (in months)
}

#Button for treatment
mr_physician_character_treatment_button_sgui = {
	scope = country
	is_valid = {
		NOT = {
			has_variable = panum_physician_character_treatment_button_active
		}
		custom_tooltip = {
			text = MR_ACTIVE_PHYSICIAN_TRIGGER
			has_variable = panum_physician_var
			var:panum_physician_var = {
				is_busy = no
			}
		}
		panum_can_any_characters_be_treated_no_tooltip_trigger = yes
	}
	effect = {
		set_variable = panum_physician_character_treatment_button_active
		panum_set_treatment_list_effect = yes
	}
}
mr_physician_character_treatment_window_active_sgui = {
	scope = country
	is_shown = {
		has_variable = panum_physician_character_treatment_button_active
		#Active Physician
		has_variable = panum_physician_var
		var:panum_physician_var = {
			is_busy = no
		}
	}
}
mr_physician_character_treatment_window_close_button_sgui = {
	scope = country
	effect = {
		remove_variable = panum_physician_character_treatment_button_active
	}
}

mr_character_has_sickly_trait_for_treatment_sgui = {
	scope = character
	is_shown = {
		has_trait = sickly
	}
}
mr_physician_sickly_treatment_button_sgui = {
	scope = country
	effect = {
		remove_variable = panum_physician_character_treatment_button_active
		random_list = {
			1 = {

				modifier = {
					multiply = panum_sickly_success_chance_value
				}
			}
			1 = {

				modifier = {
					multiply = panum_sickly_no_effect_chance_value
				}
			}
			1 = {

				modifier = {
					multiply = panum_sickly_negative_effect_chance_value
				}
			}
		}
	}
}

mr_character_has_wounded_trait_for_treatment_sgui = {
	scope = character
	is_shown = {
		has_trait = wounded
	}
}
mr_physician_wounded_treatment_button_sgui = {
	scope = country
	effect = {
		remove_variable = panum_physician_character_treatment_button_active
		random_list = {
			1 = {

				modifier = {
					multiply = panum_wounded_success_chance_value
				}
			}
			1 = {

				modifier = {
					multiply = panum_wounded_no_effect_chance_value
				}
			}
			1 = {

				modifier = {
					multiply = panum_wounded_negative_effect_chance_value
				}
			}
		}
	}
}

mr_character_has_kidney_stones_trait_for_treatment_sgui = {
	scope = character
	is_shown = {
		has_trait = kidney_stones
	}
}
mr_physician_kidney_stones_treatment_button_sgui = {
	scope = country
	effect = {
		remove_variable = panum_physician_character_treatment_button_active
		random_list = {
			1 = {

				modifier = {
					multiply = panum_kidney_stones_success_chance_value
				}
			}
			1 = {

				modifier = {
					multiply = panum_kidney_stones_no_effect_chance_value
				}
			}
			1 = {

				modifier = {
					multiply = panum_kidney_stones_negative_effect_chance_value
				}
			}
		}
	}
}

mr_character_has_cancer_trait_for_treatment_sgui = {
	scope = character
	is_shown = {
		has_trait = cancer
	}
}
mr_physician_cancer_treatment_button_sgui = {
	scope = country
	effect = {
		remove_variable = panum_physician_character_treatment_button_active
		random_list = {
			1 = {

				modifier = {
					multiply = panum_cancer_success_chance_value
				}
			}
			1 = {

				modifier = {
					multiply = panum_cancer_no_effect_chance_value
				}
			}
			1 = {

				modifier = {
					multiply = panum_cancer_negative_effect_chance_value
				}
			}
		}
	}
}