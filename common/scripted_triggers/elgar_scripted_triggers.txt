############################
# ELGAR SCRIPTED TRIGGERS  #
############################

#by Marco Dandolo

############################

#Great Composer/Composer

had_5_composers = {
	var:elgar_had_composers >= 5
}

elgar_has_composer = {
	custom_tooltip = {
		text = elgar_has_composer_tt
		trigger_if = {
			limit = { has_variable = elgar_composer_var }
		}
		trigger_else = {
			always = no
		}
	}
}

elgar_has_active_composer = {
	custom_tooltip = {
		text = elgar_has_active_composer_tt
		has_variable = elgar_composer_var
		var:elgar_composer_var ?= {
			is_busy = no
		}
	}
}

elgar_composer_not_exhausted = {
	trigger_if = {
		limit = { has_variable = elgar_composer_var }

		custom_tooltip = {
			text = elgar_composer_not_exhausted_tt
			NOT = {
				has_modifier = elgar_conductor_exhausted_modifier
			}
		}
	}
}

elgar_has_great_composer = {
	custom_tooltip = {
		text = elgar_has_great_composer_tt
		has_variable = elgar_composer_var
		var:elgar_composer_var = {
			has_trait = elgar_great_composer
		}
	}
}

elgar_has_active_great_composer = {
	custom_tooltip = {
		text = elgar_has_active_great_composer_tt
		has_variable = elgar_composer_var
		var:elgar_composer_var ?= {
			is_busy = no
			has_trait = elgar_great_composer
		}
	}
}

elgar_has_conductor = {
	custom_tooltip = {
		text = elgar_has_conductor_tt
		trigger_if = {
			limit = { has_variable = elgar_composer_var }
			var:elgar_composer_var = {
				has_trait = elgar_conductor
			}
		}
		trigger_else = {
			always = no
		}
	}
}

elgar_has_active_conductor = {
	custom_tooltip = {
		text = elgar_has_active_conductor_tt
		trigger_if = {
			limit = { has_variable = elgar_composer_var }
			var:elgar_composer_var = {
				has_trait = elgar_conductor
				is_busy = no
			}
		}
		trigger_else = {
			always = no
		}
	}
}

elgar_composer_experience_100_or_more_trigger = {
	trigger_if = {
		limit = { has_variable = elgar_composer_var }
		custom_tooltip = {
			text = elgar_composer_experience_100_or_more_trigger_tt

			var:elgar_composer_var.var:elgar_composer_experience >= 100
		}
	}
}

elgar_composer_less_than_3_masterpieces_trigger = {
	trigger_if = {
		limit = { has_variable = elgar_composer_var }
		custom_tooltip = {
			text = elgar_composer_less_than_3_masterpieces_trigger_tt

			trigger_if = {
				limit = {
					var:elgar_composer_var = {
						has_variable = elgar_composer_num_masterworks_var
					}
					var:elgar_composer_var.var:elgar_composer_num_masterworks_var <= 3
				}
			}
		}
	}
}

elgar_composer_virtuoso_or_conductor_trigger = {
	trigger_if = {
		limit = { has_variable = elgar_composer_var }
		custom_tooltip = {
			text = elgar_composer_virtuoso_or_conductor_trigger_tt

			var:elgar_composer_var = {
				OR = {
					has_trait = elgar_conductor
					has_trait = elgar_virtuoso
				}
			}
		}
	}
}

elgar_has_performance = {
	OR = {
		has_modifier = elgar_donizetti_performance_modifier
		has_modifier = elgar_berlioz_performance_modifier
		has_modifier = elgar_liszt_performance_modifier
		has_modifier = elgar_wagner_performance_modifier
		has_modifier = elgar_grieg_performance_modifier
		has_modifier = elgar_brahms_performance_modifier
		has_modifier = elgar_delius_performance_modifier
		has_modifier = elgar_mahler_performance_modifier
		has_modifier = elgar_rachmaninov_performance_modifier
		has_modifier = elgar_prokofiev_performance_modifier
	}
}

elgar_has_special_building = {
	OR = {
		any_scope_state = {
			OR = {
				has_modifier = elgar_paris_conservatory_modifier
				has_modifier = elgar_rome_conservatory_modifier
				has_modifier = elgar_leipzig_conservatory_modifier
				has_modifier = elgar_petrograd_conservatory_modifier
				has_modifier = elgar_amsterdam_concertgebouw_modifier
				has_modifier = elgar_beethoven_monument_modifier
				has_modifier = elgar_mozart_monument_modifier
				has_modifier = elgar_mozart_foundation_modifier
				has_modifier = elgar_wagner_bayreuth_modifier
				has_modifier = elgar_london_proms_modifier
			}
		}
		has_modifier = elgar_neudeutsche_musikschule_modifier
	}
}

elgar_has_center_of_art = {
	any_scope_state = {
		OR = {
			has_modifier = elgar_impressionism_center_modifier
			has_modifier = elgar_expressionism_center_modifier
			has_modifier = elgar_art_nouveau_center_modifier
		}
	}
}

elgar_has_conservatory = {
	any_scope_building = {
		has_active_production_method = pm_artists_arts_academy_conservatory
	}
}

elgar_has_ballet = {
	any_scope_building = {
		is_building_type = building_elgar_opera
		OR = {
			has_active_production_method = pm_elgar_impressionistic_ballet
			has_active_production_method = pm_elgar_expressionistic_ballet
			has_active_production_method = pm_elgar_avantgarde_ballet
		}
	}
}

elgar_has_radio_station = {
	any_scope_building = {
		is_building_type = building_urban_center
		has_active_production_method = pm_elgar_radio_stations
	}
}

############################

#Triggers to check if the Composer can perform certain tasks

#Checks if the Composer can compose masterpieces
elgar_can_composer_create_masterpiece_trigger = {
	trigger_if = {
		limit = { has_variable = elgar_composer_var }
		custom_tooltip = {
			text = elgar_can_composer_create_masterpiece_trigger_tt
			var:elgar_composer_var ?= {
				NOT = { has_variable = elgar_no_creating_masterpiece_var }
			}
		}
	}
}

#Checks if the Composer can conduct
elgar_can_composer_conduct_trigger = {
	trigger_if = {
		limit = { has_variable = elgar_composer_var }
		custom_tooltip = {
			text = elgar_can_composer_conduct_trigger_tt
			var:elgar_composer_var ?= {
				NOT = { has_variable = elgar_no_conducting_var }
			}
		}
	}
}

#Checks if the Composer can go on tours
elgar_can_composer_tour_trigger = {
	trigger_if = {
		limit = { has_variable = elgar_composer_var }
		custom_tooltip = {
			text = elgar_can_composer_tour_trigger_tt
			var:elgar_composer_var ?= {
				NOT = { has_variable = elgar_no_tours_var }
			}
		}
	}
}

############################

#Opera of Size X Trigger
elgar_has_opera_size_x_trigger = {
	# LEVEL = level of the Building
	any_scope_building = {
		is_building_type = building_elgar_opera
		level >= $LEVEL$
	}
}
elgar_has_opera_size_x_tooltip_trigger = {
	# LEVEL = level of the Building
	hidden_trigger = {
		save_temporary_scope_value_as = { #This is used to display the level in the tooltip
			name = building_level
			value = $LEVEL$
		}
	}

	custom_tooltip = {
		text = elgar_has_opera_size_x_tooltip_trigger_tt
		any_scope_building = {
			is_building_type = building_elgar_opera
			level >= $LEVEL$
		}
	}
}

#Musical Tradition Trigger
elgar_has_x_music_tradition_trigger = {
	# AMOUNT = amount of musical tradition
	trigger_if = {
		limit = {
			has_variable = elgar_music_tradition
		}
		var:elgar_music_tradition >= $AMOUNT$
	}
	trigger_else = {
		always = no
	}
}
elgar_has_x_music_tradition_tooltip_trigger = {
	# AMOUNT = amount of musical tradition
	hidden_trigger = {
		save_temporary_scope_value_as = { #This is used to display the level in the tooltip
			name = variable_amount
			value = $AMOUNT$
		}
	}

	custom_tooltip = {
		text = elgar_has_x_music_tradition_tooltip_trigger_tt
		trigger_if = {
			limit = {
				has_variable = elgar_music_tradition
			}
			var:elgar_music_tradition >= $AMOUNT$
		}
		trigger_else = {
			always = no
		}
	}
}
