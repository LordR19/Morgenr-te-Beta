############################
# PANUM SCRIPTED TRIGGERS  #
############################

#by Marco Dandolo

############################

######PHYSICIAN CHARACTER TRIGGERS######

panum_has_physician = {
	custom_tooltip = {
		text = panum_has_physician_tt
		panum_has_physician_no_tooltip_trigger = yes
	}
}
panum_has_physician_no_tooltip_trigger = {
	has_variable = panum_physician_var
}

panum_has_active_physician = {
	custom_tooltip = {
		text = panum_has_active_physician_tt
		panum_has_active_physician_no_tooltip_trigger = yes
	}
}
panum_has_active_physician_no_tooltip_trigger = {
	has_variable = panum_physician_var
	var:panum_physician_var ?= {
		is_busy = no
	}
}

######GENERAL DISEASES TRIGGER######

panum_has_epidemic_trigger = {
	OR = {
		has_journal_entry = je_panum_cholera
		has_journal_entry = je_panum_tuberculosis
		has_journal_entry = je_panum_smallpox
		has_journal_entry = je_panum_typhus
		has_journal_entry = je_panum_yellow_fever
	}
}

panum_state_has_epidemic_trigger = {
	OR = {
		panum_state_has_cholera_trigger = yes
		panum_state_has_tuberculosis_trigger = yes
		panum_state_has_smallpox_trigger = yes
		panum_state_has_typhus_trigger = yes
		panum_state_has_yellow_fever_trigger = yes
	}
}

######DISEASES TRIGGER#####

###Cholera###

panum_country_can_have_cholera_trigger = {
	game_date >= 1852.1.1 #We start with the third wave
	NOT = {
		has_variable = panum_recent_cholera_in_country_var
	}
	panum_has_cholera_prevention_trigger = no
	panum_has_epidemic_trigger = no
	panum_state_can_have_cholera_trigger = yes
}

panum_state_can_have_cholera_trigger = {
	any_scope_state = {
		NOT = {
			has_variable = panum_recent_cholera_var
		}
		any_scope_pop = {
			strata = poor
			standard_of_living <= 15
		}
		total_urbanization >= 500
	}
}

panum_has_cholera_prevention_trigger = {
	has_technology_researched = modern_sewerage
	institution_investment_level = {
		institution	= institution_health_system
		value >= 3
	}
	NOT = {
		has_law = law_type:law_no_health_system
	}
}

panum_state_has_cholera_trigger = {
	OR = {
		has_modifier = panum_epidemic_cholera_deadly_modifier
		has_modifier = panum_epidemic_cholera_severe_modifier
		has_modifier = panum_epidemic_cholera_normal_modifier
		has_modifier = panum_epidemic_cholera_mild_modifier
	}
}

panum_has_cholera_description_trigger = {
	custom_tooltip = {
		text = panum_has_cholera_description_tt
		has_variable = panum_cholera_description_var
	}
}

panum_has_cholera_treatment_trigger = {
	custom_tooltip = {
		text = panum_has_cholera_treatment_tt
		has_variable = panum_cholera_treatment_var
	}
}

###Tuberculosis###

panum_country_can_have_tuberculosis_trigger = {
	NOT = {
		has_variable = panum_recent_tuberculosis_in_country_var
	}
	panum_has_tuberculosis_prevention_trigger = no
	panum_has_epidemic_trigger = no
	any_scope_state = {
		NOT = {
			has_variable = panum_recent_tuberculosis_var
		}
		any_scope_pop = {
			strata = poor
			standard_of_living <= 20
		}
		total_urbanization >= 750
	}
}

panum_state_can_have_tuberculosis_trigger = {
	NOT = {
		has_variable = panum_tuberculosis_contagious_var
	}
	any_scope_state = {
		NOT = {
			has_variable = panum_recent_tuberculosis_var
		}
		any_neighbouring_state = {
			panum_state_has_tuberculosis_trigger = yes
		}
		any_scope_pop = {
			strata = poor
			standard_of_living <= 20
		}
		total_urbanization >= 750
	}
}

panum_has_tuberculosis_prevention_trigger = {
	has_technology_researched = pasteurization
	institution_investment_level = {
		institution	= institution_health_system
		value >= 4
	}
	NOT = {
		has_law = law_type:law_no_health_system
	}
}

panum_state_has_tuberculosis_trigger = {
	OR = {
		has_modifier = panum_epidemic_tuberculosis_severe_modifier
		has_modifier = panum_epidemic_tuberculosis_normal_modifier
		has_modifier = panum_epidemic_tuberculosis_mild_modifier
	}
}

panum_has_tuberculosis_description_trigger = {
	custom_tooltip = {
		text = panum_has_tuberculosis_description_tt
		has_variable = panum_tuberculosis_description_var
	}
}

panum_has_tuberculosis_treatment_trigger = {
	custom_tooltip = {
		text = panum_has_tuberculosis_treatment_tt
		has_variable = panum_tuberculosis_treatment_var
	}
}

###Smallpox###

panum_country_can_have_smallpox_trigger = {
	NOT = {
		has_variable = panum_recent_smallpox_in_country_var
	}
	panum_has_smallpox_prevention_trigger = no
	panum_has_epidemic_trigger = no
	any_scope_state = {
		NOT = {
			has_variable = panum_recent_smallpox_var
		}
		any_scope_pop = {
			strata = poor
			standard_of_living <= 16
		}
	}
}

panum_state_can_have_smallpox_trigger = {
	any_scope_state = {
		NOT = {
			has_variable = panum_recent_smallpox_var
		}
		any_neighbouring_state = {
			panum_state_has_smallpox_trigger = yes
		}
		any_scope_pop = {
			strata = poor
			standard_of_living <= 16
		}
	}
}

panum_has_smallpox_prevention_trigger = {
	has_technology_researched = panum_vaccination_tech
	institution_investment_level = {
		institution	= institution_health_system
		value >= 2
	}
	NOT = {
		has_law = law_type:law_no_health_system
	}
}

panum_state_has_smallpox_trigger = {
	OR = {
		has_modifier = panum_epidemic_smallpox_severe_modifier
		has_modifier = panum_epidemic_smallpox_normal_modifier
		has_modifier = panum_epidemic_smallpox_mild_modifier
	}
}

panum_has_smallpox_description_trigger = {
	custom_tooltip = {
		text = panum_has_smallpox_description_tt
		has_variable = panum_smallpox_description_var
	}
}

panum_has_smallpox_treatment_trigger = {
	custom_tooltip = {
		text = panum_has_smallpox_treatment_tt
		has_variable = panum_smallpox_treatment_var
	}
}

###Typhus###

panum_country_can_have_typhus_trigger = {
	NOT = {
		has_variable = panum_recent_typhus_in_country_var
	}
	panum_has_typhus_prevention_trigger = no
	panum_has_epidemic_trigger = no
	any_scope_state = {
		NOT = {
			has_variable = panum_recent_typhus_var
		}
		devastation > 0.15
	}
}

panum_state_can_have_typhus_trigger = {
	any_scope_state = {
		NOT = {
			has_variable = panum_recent_typhus_var
		}
		any_neighbouring_state = {
			panum_state_has_typhus_trigger = yes
		}
		devastation > 0.15
	}
}

panum_has_typhus_prevention_trigger = {
	has_technology_researched = antibiotics
	institution_investment_level = {
		institution	= institution_health_system
		value >= 3
	}
	NOT = {
		has_law = law_type:law_no_health_system
	}
}

panum_state_has_typhus_trigger = {
	OR = {
		has_modifier = panum_epidemic_typhus_severe_modifier
		has_modifier = panum_epidemic_typhus_normal_modifier
		has_modifier = panum_epidemic_typhus_mild_modifier
	}
}

panum_has_typhus_description_trigger = {
	custom_tooltip = {
		text = panum_has_typhus_description_tt
		has_variable = panum_typhus_description_var
	}
}

panum_has_typhus_treatment_trigger = {
	custom_tooltip = {
		text = panum_has_typhus_treatment_tt
		has_variable = panum_typhus_treatment_var
	}
}

###Yellow fever###

panum_country_can_have_yellow_fever_trigger = {
	NOT = {
		has_variable = panum_recent_yellow_fever_in_country_var
	}
	panum_has_yellow_fever_prevention_trigger = no
	panum_has_epidemic_trigger = no
	any_scope_state = {
		OR = {
			region = sr:region_dixie
			region = sr:region_mexico
			region = sr:region_central_america
			region = sr:region_caribbean

			region = sr:region_brazil
			region = sr:region_gran_colombia
			state_region = s:STATE_SANTA_CRUZ
			state_region = s:STATE_LA_PAZ
			state_region = s:STATE_PASTAZA
			state_region = s:STATE_ACRE
			state_region = s:STATE_ALTO_PARAGUAY
			state_region = s:STATE_BAJO_PARAGUAY
			state_region = s:STATE_CORRIENTES
			state_region = s:STATE_SANTA_FE
			state_region = s:STATE_BUENOS_AIRES

			AND = {
				state_is_in_africa = yes
				has_state_trait = state_trait_malaria
			}
			AND = {
				state_is_in_africa = yes
				has_state_trait = state_trait_severe_malaria
			}
		}
	}
}

panum_state_can_have_yellow_fever_trigger = {
	any_scope_state = {
		any_neighbouring_state = {
			panum_state_has_yellow_fever_trigger = yes
		}
		OR = {
			region = sr:region_dixie
			region = sr:region_mexico
			region = sr:region_central_america
			region = sr:region_caribbean

			region = sr:region_brazil
			region = sr:region_gran_colombia
			state_region = s:STATE_SANTA_CRUZ
			state_region = s:STATE_LA_PAZ
			state_region = s:STATE_PASTAZA
			state_region = s:STATE_ACRE
			state_region = s:STATE_ALTO_PARAGUAY
			state_region = s:STATE_BAJO_PARAGUAY
			state_region = s:STATE_CORRIENTES
			state_region = s:STATE_SANTA_FE
			state_region = s:STATE_BUENOS_AIRES

			AND = {
				state_is_in_africa = yes
				has_state_trait = state_trait_malaria
			}
			AND = {
				state_is_in_africa = yes
				has_state_trait = state_trait_severe_malaria
			}
		}
	}
}

panum_has_yellow_fever_prevention_trigger = {
	has_technology_researched = malaria_prevention
	institution_investment_level = {
		institution	= institution_health_system
		value >= 3
	}
	NOT = {
		has_law = law_type:law_no_health_system
	}
}

panum_state_has_yellow_fever_trigger = {
	OR = {
		has_modifier = panum_epidemic_yellow_fever_severe_modifier
		has_modifier = panum_epidemic_yellow_fever_normal_modifier
		has_modifier = panum_epidemic_yellow_fever_mild_modifier
	}
}

panum_has_yellow_fever_description_trigger = {
	custom_tooltip = {
		text = panum_has_yellow_fever_description_tt
		has_variable = panum_yellow_fever_description_var
	}
}

panum_has_yellow_fever_treatment_trigger = {
	custom_tooltip = {
		text = panum_has_yellow_fever_treatment_tt
		has_variable = panum_yellow_fever_treatment_var
	}
}

############################

######SGUI######

### Triggers to determine if a description of a disease is possible ###

panum_can_describe_local_disease_trigger = {
	OR = {
		AND = {
			has_journal_entry = je_panum_cholera
			panum_has_cholera_description_trigger = no
		}
		AND = {
			has_journal_entry = je_panum_tuberculosis
			panum_has_tuberculosis_description_trigger = no
		}
		AND = {
			has_journal_entry = je_panum_smallpox
			panum_has_smallpox_description_trigger = no
		}
		AND = {
			has_journal_entry = je_panum_typhus
			panum_has_typhus_description_trigger = no
		}
		AND = {
			has_journal_entry = je_panum_yellow_fever
			panum_has_yellow_fever_description_trigger = no
		}
	}
}

panum_can_describe_foreign_disease_trigger = {
	OR = {
		AND = {
			any_country = {
				has_journal_entry = je_panum_cholera
				has_diplomatic_relevance = ROOT
			}
			panum_has_cholera_description_trigger = no
		}
		AND = {
			any_country = {
				has_journal_entry = je_panum_tuberculosis
				has_diplomatic_relevance = ROOT
			}
			panum_has_tuberculosis_description_trigger = no
		}
		AND = {
			any_country = {
				has_journal_entry = je_panum_smallpox
				has_diplomatic_relevance = ROOT
			}
			panum_has_smallpox_description_trigger = no
		}
		AND = {
			any_country = {
				has_journal_entry = je_panum_typhus
				has_diplomatic_relevance = ROOT
			}
			panum_has_typhus_description_trigger = no
		}
		AND = {
			any_country = {
				has_journal_entry = je_panum_yellow_fever
				has_diplomatic_relevance = ROOT
			}
			panum_has_yellow_fever_description_trigger = no
		}
	}
}

### Triggers to determine if a treatment of a disease is possible ###

panum_can_find_treatment_local_disease_trigger = {
	OR = {
		AND = {
			has_journal_entry = je_panum_cholera
			panum_has_cholera_treatment_trigger = no
		}
		AND = {
			has_journal_entry = je_panum_tuberculosis
			panum_has_tuberculosis_treatment_trigger = no
		}
		AND = {
			has_journal_entry = je_panum_smallpox
			panum_has_smallpox_treatment_trigger = no
		}
		AND = {
			has_journal_entry = je_panum_typhus
			panum_has_typhus_treatment_trigger = no
		}
		AND = {
			has_journal_entry = je_panum_yellow_fever
			panum_has_yellow_fever_treatment_trigger = no
		}
	}
}

panum_can_find_treatment_foreign_disease_trigger = {
	OR = {
		AND = {
			any_country = {
				has_journal_entry = je_panum_cholera
			}
			panum_has_cholera_treatment_trigger = no
		}
		AND = {
			any_country = {
				has_journal_entry = je_panum_tuberculosis
			}
			panum_has_tuberculosis_treatment_trigger = no
		}
		AND = {
			any_country = {
				has_journal_entry = je_panum_smallpox
			}
			panum_has_smallpox_treatment_trigger = no
		}
		AND = {
			any_country = {
				has_journal_entry = je_panum_typhus
			}
			panum_has_typhus_treatment_trigger = no
		}
		AND = {
			any_country = {
				has_journal_entry = je_panum_yellow_fever
			}
			panum_has_yellow_fever_treatment_trigger = no
		}
	}
}

############################

### Triggers for the rating display physician ###
panum_physician_fantastic_rating_trigger = {
	panum_physician_character_rating_value > 8
}

panum_physician_very_good_rating_trigger = {
	panum_physician_character_rating_value > 5
}

panum_physician_good_rating_trigger = {
	panum_physician_character_rating_value > 2
}

panum_physician_mediocre_rating_trigger = {
	panum_physician_character_rating_value > 0
}
